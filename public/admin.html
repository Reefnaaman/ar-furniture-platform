<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - newfurniture.live</title>
    <!-- Force deployment refresh -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 255, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #0a0c10 0%, #0d1117 50%, #111418 100%);
            color: #e6edf3;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="0.5" fill="%23ffffff" opacity="0.02"/><circle cx="75" cy="75" r="0.3" fill="%23ffffff" opacity="0.02"/><circle cx="50" cy="10" r="0.4" fill="%23ffffff" opacity="0.01"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>'),
                linear-gradient(180deg, rgba(88, 166, 255, 0.02) 0%, transparent 100%);
            pointer-events: none;
            z-index: -1;
        }
        
        .header {
            background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 2rem;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-button {
            background: rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            border: 1px solid rgba(240, 246, 252, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 14px;
        }
        
        .nav-button:hover {
            background: rgba(240, 246, 252, 0.15);
            border-color: rgba(240, 246, 252, 0.3);
            transform: translateY(-1px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.9) 0%, rgba(30, 35, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.15);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.5), transparent);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
            border-color: rgba(88, 166, 255, 0.3);
        }
        
        .stat-label {
            color: #7d8590;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #e6edf3;
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-icon {
            float: right;
            font-size: 2rem;
            opacity: 0.4;
        }
        
        .models-section {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.9) 0%, rgba(30, 35, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.15);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            position: relative;
            overflow: hidden;
        }
        
        .models-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.6), rgba(120, 200, 255, 0.6), transparent);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e6edf3;
        }
        
        .refresh-button {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .refresh-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .model-card {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(30, 35, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .model-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.4), transparent);
            z-index: 1;
        }
        
        .model-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 2px 0 rgba(88, 166, 255, 0.2) inset;
            border-color: rgba(88, 166, 255, 0.4);
        }
        
        .model-card:hover::before {
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.8), rgba(120, 200, 255, 0.6), transparent);
        }
        
        .model-preview {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, #0d1117 0%, #21262d 100%);
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .model-viewer {
            width: 100%;
            height: 100%;
        }
        
        .model-info {
            padding: 16px;
        }
        
        .model-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 8px;
        }
        
        .model-description {
            color: #7d8590;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .model-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #7d8590;
        }
        
        .model-id {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: rgba(240, 246, 252, 0.1);
            color: #79c0ff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .model-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #58a6ff;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #7d8590;
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .model-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 6px 10px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            background: rgba(240, 246, 252, 0.05);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            color: #e6edf3;
            display: inline-block;
            flex: 1;
            text-align: center;
        }
        
        .action-button:hover {
            border-color: rgba(88, 166, 255, 0.5);
            background: rgba(88, 166, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .action-button.delete {
            color: #f85149;
            border-color: rgba(248, 81, 73, 0.3);
            background: rgba(248, 81, 73, 0.1);
        }
        
        .action-button.delete:hover {
            background: rgba(248, 81, 73, 0.2);
            border-color: rgba(248, 81, 73, 0.5);
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 6px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }
        
        
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            padding: 30px;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #e6edf3;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            background: rgba(240, 246, 252, 0.05);
            color: #e6edf3;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #58a6ff;
            background: rgba(240, 246, 252, 0.1);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .modal-button.primary {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            font-weight: 500;
        }
        
        .modal-button.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }
        
        .modal-button.secondary {
            background: rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            border: 1px solid rgba(240, 246, 252, 0.2);
        }
        
        .modal-button.secondary:hover {
            background: rgba(240, 246, 252, 0.15);
            border-color: rgba(240, 246, 252, 0.3);
        }
        
        .copy-button {
            cursor: pointer;
            color: #667eea;
            margin-left: 10px;
            font-size: 1.2rem;
        }
        
        .copy-button:hover {
            color: #5568d3;
        }
        
        /* Futuristic Upload Styles */
        .futuristic-upload {
            max-width: 500px !important;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.98) 0%, rgba(30, 35, 42, 0.95) 100%);
            border: 2px solid rgba(88, 166, 255, 0.2);
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        }
        
        .upload-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .upload-icon-container {
            display: flex;
            justify-content: center;
            margin-bottom: 12px;
        }
        
        .upload-icon-bg {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.2), rgba(120, 200, 255, 0.1));
            border: 2px solid rgba(88, 166, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: iconPulse 3s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(88, 166, 255, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(88, 166, 255, 0); }
        }
        
        .upload-icon {
            width: 32px;
            height: 32px;
            color: #58a6ff;
        }
        
        .upload-title {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #e6edf3, #58a6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .upload-subtitle {
            color: #7d8590;
            font-size: 0.95rem;
            font-weight: 400;
        }
        
        .futuristic-drop-zone {
            position: relative;
            margin-bottom: 15px;
        }
        
        .drop-zone-content {
            border: 2px dashed rgba(88, 166, 255, 0.3);
            border-radius: 16px;
            padding: 25px 15px;
            text-align: center;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.02), rgba(120, 200, 255, 0.01));
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .drop-zone-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(88, 166, 255, 0.1), transparent);
            border-radius: 16px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .drop-zone-content:hover {
            border-color: rgba(88, 166, 255, 0.5);
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.05), rgba(120, 200, 255, 0.02));
        }
        
        .drop-zone-content:hover::before {
            opacity: 1;
        }
        
        .drop-animation {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .drop-ring {
            width: 60px;
            height: 60px;
            border: 2px solid rgba(88, 166, 255, 0.3);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: ripple 2s ease-out infinite;
        }
        
        .drop-ring:nth-child(2) { animation-delay: 0.5s; }
        .drop-ring:nth-child(3) { animation-delay: 1s; }
        
        @keyframes ripple {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }
            100% {
                width: 80px;
                height: 80px;
                opacity: 0;
            }
        }
        
        .upload-text {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .primary-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e6edf3;
        }
        
        .secondary-text {
            font-size: 0.95rem;
            color: #7d8590;
        }
        
        .click-text {
            color: #58a6ff;
            font-weight: 500;
        }
        
        .format-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .format-badge {
            background: rgba(88, 166, 255, 0.1);
            color: #58a6ff;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(88, 166, 255, 0.2);
        }
        
        .size-limit {
            color: #7d8590;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .drag-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(120, 200, 255, 0.1));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        
        .futuristic-drop-zone.drag-over .drag-overlay {
            opacity: 1;
        }
        
        .drag-content {
            text-align: center;
            color: #58a6ff;
        }
        
        .drag-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 0.6s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .file-preview-container {
            margin-bottom: 25px;
        }
        
        .file-preview-card {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(120, 200, 255, 0.05));
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-icon {
            font-size: 2rem;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 4px;
        }
        
        .file-size {
            color: #7d8590;
            font-size: 0.9rem;
        }
        
        .remove-file-btn {
            background: rgba(248, 81, 73, 0.1);
            color: #f85149;
            border: 1px solid rgba(248, 81, 73, 0.3);
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .remove-file-btn:hover {
            background: rgba(248, 81, 73, 0.2);
        }
        
        .input-group {
            position: relative;
            margin-bottom: 15px;
        }
        
        .futuristic-input {
            width: 100%;
            background: rgba(240, 246, 252, 0.03);
            border: 1px solid rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .futuristic-input:focus {
            outline: none;
            border-color: rgba(88, 166, 255, 0.5);
            background: rgba(240, 246, 252, 0.05);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }
        
        .futuristic-input.textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .input-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            width: 0;
            background: linear-gradient(90deg, #58a6ff, #79c0ff);
            transition: width 0.3s ease;
            border-radius: 1px;
        }
        
        .futuristic-input:focus + .input-line {
            width: 100%;
        }
        
        .futuristic-primary {
            position: relative;
            overflow: hidden;
        }
        
        .button-text {
            position: relative;
            z-index: 2;
        }
        
        .button-glow {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .futuristic-primary:hover .button-glow {
            left: 100%;
        }
        
        .upload-progress {
            margin-top: 25px;
        }
        
        .progress-label {
            color: #e6edf3;
            font-weight: 500;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .progress-track {
            flex: 1;
            height: 6px;
            background: rgba(240, 246, 252, 0.1);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #58a6ff, #79c0ff);
            border-radius: 3px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.5), transparent);
            opacity: 0;
            animation: progressGlow 2s ease-in-out infinite;
        }
        
        @keyframes progressGlow {
            0%, 100% { opacity: 0; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }
        
        .progress-percentage {
            color: #58a6ff;
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 40px;
        }
        
        .customer-select {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2358a6ff" d="M6 8L0 2h12L6 8z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 50px;
        }
        
        /* Customer Groups Styles */
        .customer-groups {
            margin-top: 30px;
        }
        
        .customer-group {
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.6), rgba(30, 35, 42, 0.5));
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .customer-group:hover {
            border-color: rgba(88, 166, 255, 0.2);
        }
        
        /* Sidebar Styles */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(13, 17, 23, 0.95) 0%, rgba(22, 27, 34, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(240, 246, 252, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 8px 0 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            text-align: center;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 5px;
        }
        
        .sidebar-subtitle {
            font-size: 0.85rem;
            color: #7d8590;
        }
        
        .sidebar-search {
            padding: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .search-input {
            width: 100%;
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 12px;
            color: #e6edf3;
            padding: 12px 16px;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            border-color: rgba(88, 166, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }
        
        .search-input::placeholder {
            color: #7d8590;
        }
        
        .sidebar-stats {
            padding: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .sidebar-stats-title {
            font-size: 0.9rem;
            color: #7d8590;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .sidebar-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sidebar-stat-label {
            color: #e6edf3;
            font-size: 0.85rem;
        }
        
        .sidebar-stat-value {
            color: #58a6ff;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .sidebar-section {
            padding: 20px;
        }
        
        .sidebar-customers {
            padding: 20px;
            flex: 1;
        }
        
        .sidebar-customers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sidebar-customers-title {
            font-size: 0.9rem;
            color: #7d8590;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .add-customer-btn {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            color: #58a6ff;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-customer-btn:hover {
            background: rgba(88, 166, 255, 0.2);
        }
        
        .customer-list {
            list-style: none;
        }
        
        .customer-item {
            padding: 12px 16px;
            margin-bottom: 6px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            position: relative;
        }
        
        .customer-item:hover {
            background: rgba(240, 246, 252, 0.05);
            border-color: rgba(240, 246, 252, 0.1);
        }
        
        .customer-item.active {
            background: rgba(88, 166, 255, 0.1);
            border-color: rgba(88, 166, 255, 0.3);
        }
        
        .customer-item-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .customer-name {
            color: #e6edf3;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .customer-count {
            background: rgba(88, 166, 255, 0.2);
            color: #58a6ff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .main-content {
            margin-left: 320px;
            flex: 1;
        }
        
        .add-customer-form {
            display: none;
            padding: 10px;
            background: rgba(22, 27, 34, 0.8);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .add-customer-input {
            width: 100%;
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 8px;
            color: #e6edf3;
            padding: 8px 12px;
            font-size: 0.85rem;
            outline: none;
            margin-bottom: 8px;
        }
        
        .add-customer-actions {
            display: flex;
            gap: 8px;
        }
        
        .add-customer-save,
        .add-customer-cancel {
            flex: 1;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-customer-save {
            background: rgba(46, 160, 67, 0.2);
            border: 1px solid rgba(46, 160, 67, 0.4);
            color: #3fb950;
        }
        
        .add-customer-cancel {
            background: rgba(248, 81, 73, 0.2);
            border: 1px solid rgba(248, 81, 73, 0.4);
            color: #f85149;
        }
        
        
        
        /* Assign Dropdown */
        .assign-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .assign-button {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            color: #ffa500;
        }
        
        .assign-button:hover {
            background: rgba(255, 165, 0, 0.2);
            border-color: rgba(255, 165, 0, 0.5);
        }
        
        .assign-dropdown-content {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            min-width: 200px;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(30, 35, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            padding: 8px 0;
            margin-bottom: 8px;
        }
        
        .assign-dropdown.show .assign-dropdown-content {
            display: block;
        }
        
        .assign-option {
            padding: 10px 16px;
            color: #e6edf3;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .assign-option:last-child {
            border-bottom: none;
        }
        
        .assign-option:hover {
            background: rgba(240, 246, 252, 0.1);
        }
        
        .assign-option.current {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            font-weight: 500;
        }
        
        .assign-option.new-customer {
            background: rgba(46, 160, 67, 0.1);
            color: #3fb950;
            border-top: 1px solid rgba(240, 246, 252, 0.1);
            font-weight: 500;
        }
        
        .assign-option.new-customer:hover {
            background: rgba(46, 160, 67, 0.2);
        }

        .customer-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(120, 200, 255, 0.05));
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .customer-header:hover {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(120, 200, 255, 0.08));
        }
        
        .customer-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e6edf3;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .customer-badge {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .customer-stats {
            color: #7d8590;
            font-size: 0.9rem;
        }
        
        .expand-icon {
            color: #58a6ff;
            transition: transform 0.3s ease;
        }
        
        .customer-group.collapsed .expand-icon {
            transform: rotate(-90deg);
        }
        
        .customer-content {
            padding: 30px;
            display: none;
        }
        
        .customer-group:not(.collapsed) .customer-content {
            display: block;
        }
        
        /* User Management Styles */
        .user-management-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .user-management-list.expanded {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.05);
            transition: background 0.2s ease;
        }
        
        .user-item:hover {
            background: rgba(240, 246, 252, 0.03);
        }
        
        .user-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .user-name {
            color: #e6edf3;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .user-role {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user-details {
            font-size: 0.8rem;
            color: #7d8590;
            margin-bottom: 8px;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .user-action-btn {
            padding: 6px 10px;
            font-size: 0.9rem;
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 8px;
            background: rgba(88, 166, 255, 0.15);
            color: #58a6ff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .user-action-btn:hover {
            background: rgba(88, 166, 255, 0.25);
            border-color: rgba(88, 166, 255, 0.5);
            transform: translateY(-1px);
        }
        
        .edit-section {
            padding: 20px;
            margin-bottom: 15px;
            background: rgba(22, 27, 34, 0.6);
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 12px;
        }
        
        .section-title {
            color: #e6edf3;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .user-edit-sections {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Logout Section */
        .sidebar-logout {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid rgba(240, 246, 252, 0.1);
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.5) 0%, rgba(30, 35, 42, 0.3) 100%);
        }
        
        .logout-user-info {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }
        
        .logout-username {
            color: #e6edf3;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .logout-role {
            color: #7d8590;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .logout-button {
            width: 100%;
            padding: 10px;
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            color: #f85149;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .logout-button:hover {
            background: rgba(248, 81, 73, 0.2);
            border-color: rgba(248, 81, 73, 0.5);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    
    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Admin Panel</div>
                <div class="sidebar-subtitle">Furniture Management</div>
            </div>
            
            <div class="sidebar-search">
                <input type="text" class="search-input" placeholder="Search furniture or customers..." 
                       oninput="handleSearch(this.value)" />
            </div>
            
            <!-- Upload Button -->
            <div style="padding: 20px; border-bottom: 1px solid rgba(240, 246, 252, 0.1);">
                <button onclick="toggleUploadModal()" class="modal-button primary" style="width: 100%; padding: 12px; font-size: 0.9rem; background: rgba(88, 166, 255, 0.15); border: 1px solid rgba(88, 166, 255, 0.3); color: #58a6ff; border-radius: 12px; transition: all 0.2s ease;">
                    📤 Upload Furniture
                </button>
            </div>
            
            <!-- Management Section -->
            <div class="sidebar-section">
                <div class="sidebar-customers-header" onclick="toggleUserManagement()" style="cursor: pointer;">
                    <span class="sidebar-customers-title">👥 Manage Users</span>
                    <span id="userManagementToggle" style="transform: rotate(0deg); transition: transform 0.2s;">▼</span>
                </div>
                
                <!-- Expandable User Management Section -->
                <div id="userManagementSection" style="margin-top: 10px;">
                    <!-- Add User Button -->
                    <div id="addUserButtonContainer" style="padding: 15px; border-bottom: 1px solid rgba(240, 246, 252, 0.1); max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                        <button onclick="toggleUserModal()" class="modal-button primary" style="width: 100%; padding: 12px; font-size: 0.9rem; background: rgba(88, 166, 255, 0.15); border: 1px solid rgba(88, 166, 255, 0.3); color: #58a6ff; border-radius: 12px; transition: all 0.2s ease;">
                            + Add New User
                        </button>
                    </div>
                    
                    <!-- User List -->
                    <div id="userList" class="user-management-list">
                        <div class="loading-users" style="padding: 20px; text-align: center; color: #7d8590;">
                            Loading users...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-customers" style="margin-top: 5px;">
                <div class="sidebar-customers-header">
                    <span class="sidebar-customers-title">Customers</span>
                    <button class="add-customer-btn" onclick="showAddCustomerForm()">+ Add</button>
                </div>
                
                <!-- Add Customer Form -->
                <div class="add-customer-form" id="addCustomerForm">
                    <input type="text" class="add-customer-input" placeholder="Customer name" id="newCustomerName" onkeydown="handleCustomerNameKeydown(event)" />
                    <div class="add-customer-actions">
                        <button class="add-customer-save" onclick="saveNewCustomer()">Save</button>
                        <button class="add-customer-cancel" onclick="hideAddCustomerForm()">Cancel</button>
                    </div>
                </div>
                
                <ul class="customer-list" id="customerList">
                    <!-- Customer items will be populated here -->
                </ul>
            </div>
            
            <!-- Quick Stats moved to bottom -->
            <div class="sidebar-stats">
                <div class="sidebar-stats-title">Quick Stats</div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Total Furniture</span>
                    <span class="sidebar-stat-value" id="sidebarTotalModels">-</span>
                </div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Customers</span>
                    <span class="sidebar-stat-value" id="sidebarTotalCustomers">-</span>
                </div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Total Views</span>
                    <span class="sidebar-stat-value" id="sidebarTotalViews">-</span>
                </div>
            </div>
            
            <!-- Logout Section -->
            <div class="sidebar-logout">
                <div class="logout-user-info">
                    <span class="logout-username" id="loggedInUsername">admin</span>
                    <span class="logout-role">Administrator</span>
                </div>
                <button class="logout-button" onclick="logout()">Sign Out</button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="header">
                <div class="header-content">
                    <h1>⚙️ Admin Dashboard</h1>
                </div>
            </div>
            
            <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📦</div>
                <div class="stat-label">Total Furniture</div>
                <div class="stat-value" id="totalModels">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">👁️</div>
                <div class="stat-label">Total Views</div>
                <div class="stat-value" id="totalViews">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">💾</div>
                <div class="stat-label">Storage Used</div>
                <div class="stat-value" id="totalSize">-</div>
            </div>
        </div>
        
        <div class="models-section">
            <div class="section-header">
                <h2 class="section-title">Uploaded Furniture</h2>
                <button class="refresh-button" onclick="loadModels()">Refresh</button>
            </div>
            
            <div id="modelsContainer">
                <div class="loading">Loading furniture...</div>
            </div>
        </div>
    </div>
    
    
    <div class="password-modal" id="uploadModal">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L15.09 8.26L22 9L17 14.74L18.18 21.02L12 18L5.82 21.02L7 14.74L2 9L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title">Upload New Furniture</h3>
                <p class="upload-subtitle">Transform your 3D furniture into AR experiences</p>
            </div>
            
            <form id="uploadForm">
                <div class="futuristic-drop-zone" id="dropZone">
                    <input type="file" id="fileInput" accept=".glb,.gltf" style="display: none;">
                    <div class="drop-zone-content">
                        <div class="drop-animation">
                            <div class="drop-ring"></div>
                            <div class="drop-ring"></div>
                            <div class="drop-ring"></div>
                        </div>
                        <div class="upload-text">
                            <span class="primary-text">Drag & drop your 3D furniture</span>
                            <span class="secondary-text">or <span class="click-text">click to browse</span></span>
                        </div>
                        <div class="format-info">
                            <span class="format-badge">GLB</span>
                            <span class="format-badge">GLTF</span>
                            <span class="size-limit">Max 100MB</span>
                        </div>
                    </div>
                    <div class="drag-overlay">
                        <div class="drag-content">
                            <div class="drag-icon">⚡</div>
                            <span>Drop to upload</span>
                        </div>
                    </div>
                </div>
                
                <div class="file-preview-container" id="filePreviewContainer" style="display: none;">
                    <div class="file-preview-card">
                        <div class="file-icon">📦</div>
                        <div class="file-info">
                            <div class="file-name" id="previewFileName"></div>
                            <div class="file-size" id="previewFileSize"></div>
                        </div>
                        <button type="button" class="remove-file-btn" onclick="removeFile()">✕</button>
                    </div>
                </div>
                
                <div class="input-group">
                    <select id="customerSelect" class="futuristic-input customer-select">
                        <option value="napo:NAPO">NAPO</option>
                        <option value="unassigned:Unassigned">Unassigned</option>
                    </select>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <input type="text" id="titleInput" placeholder="Furniture Title" class="futuristic-input">
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <textarea id="descriptionInput" placeholder="Description (optional)" rows="3" class="futuristic-input textarea"></textarea>
                    <div class="input-line"></div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeUploadModal()">Cancel</button>
                    <button type="submit" class="modal-button primary futuristic-primary" id="uploadButton">
                        <span class="button-text">Upload Furniture</span>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </form>
            
            <div id="uploadProgress" class="upload-progress" style="display: none;">
                <div class="progress-label" id="uploadStatus">Uploading...</div>
                <div class="progress-container">
                    <div class="progress-track">
                        <div id="progressBar" class="progress-fill"></div>
                        <div class="progress-glow"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div class="password-modal" id="userEditModal" style="display: none;">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title" id="editModalTitle">⚙️ Manage User</h3>
                <p class="upload-subtitle" id="editModalSubtitle">Edit user settings and permissions</p>
            </div>
            
            <div class="user-edit-sections">
                <!-- Password Reset Section -->
                <div class="edit-section">
                    <h4 class="section-title">🔑 Password Reset</h4>
                    <div class="input-group">
                        <input type="password" id="editNewPassword" placeholder="New Password" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    <button type="button" class="modal-button secondary" onclick="resetUserPassword()" style="width: 100%; margin-top: 10px;">
                        Generate Random Password
                    </button>
                </div>
                
                <!-- Customer Info Section (only for customer role) -->
                <div class="edit-section" id="customerInfoSection" style="display: none;">
                    <h4 class="section-title">👤 Customer Information</h4>
                    <div class="input-group">
                        <input type="text" id="editCustomerId" placeholder="Customer ID (e.g., napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    <div class="input-group">
                        <input type="text" id="editCustomerName" placeholder="Customer Display Name" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                </div>
                
                <!-- Account Status Section -->
                <div class="edit-section">
                    <h4 class="section-title">🔄 Account Status</h4>
                    <button type="button" id="toggleStatusBtn" class="modal-button danger" onclick="toggleUserStatus()" style="width: 100%;">
                        Deactivate Account
                    </button>
                    <p id="protectedUserNote" style="display: none; color: #7d8590; font-size: 0.8rem; text-align: center; margin-top: 10px;">
                        Admin users are protected and cannot be deactivated.
                    </p>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="modal-button secondary" onclick="closeUserEditModal()">Cancel</button>
                <button type="button" class="modal-button primary futuristic-primary" onclick="saveUserChanges()">
                    <span class="button-text">Save Changes</span>
                    <div class="button-glow"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="password-modal" id="userModal" style="display: none;">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M12.5 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8ZM16 11l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title">Create New User</h3>
                <p class="upload-subtitle">Add customer or admin accounts</p>
            </div>
            
            <form id="userForm">
                <div class="input-group">
                    <input type="text" id="newUsername" placeholder="Username" class="futuristic-input" required>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <input type="password" id="newPassword" placeholder="Password" class="futuristic-input" required>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <select id="newRole" class="futuristic-input" required>
                        <option value="">Select Role</option>
                        <option value="customer">Customer</option>
                        <option value="admin">Administrator</option>
                    </select>
                    <div class="input-line"></div>
                </div>
                
                <div id="customerFields" style="display: none;">
                    <div class="input-group">
                        <input type="text" id="newCustomerId" placeholder="Customer ID (e.g., napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    
                    <div class="input-group">
                        <input type="text" id="newCustomerName" placeholder="Customer Display Name (e.g., Napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeUserModal()">Cancel</button>
                    <button type="submit" class="modal-button primary futuristic-primary" id="createUserButton">
                        <span class="button-text">Create User</span>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        let deleteTarget = null;
        
        // Load models on page load
        loadModels();
        
        // Initialize customers after customerManager is defined
        // This will be called after the CustomerDataManager class is instantiated
        
        async function loadModels() {
            try {
                const response = await fetch('/api/models');
                if (!response.ok) throw new Error('Failed to load models');
                
                const data = await response.json();
                
                // Update main stats
                document.getElementById('totalModels').textContent = data.stats.totalModels || 0;
                document.getElementById('totalViews').textContent = data.stats.totalViews || 0;
                document.getElementById('totalSize').textContent = formatFileSize(data.stats.totalSize || 0);
                
                // Update sidebar stats
                document.getElementById('sidebarTotalModels').textContent = data.stats.totalModels || 0;
                document.getElementById('sidebarTotalViews').textContent = data.stats.totalViews || 0;
                
                // Group models by customer
                displayGroupedModels(data.models);
                
            } catch (error) {
                console.error('Error loading furniture:', error);
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>Error Loading Furniture</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize customers using centralized manager
        async function initializeCustomers() {
            await customerManager.loadFromAPI();
        }
        
        // Legacy function for backward compatibility
        async function loadCustomers() {
            await customerManager.loadFromAPI();
        }
        
        // Update sidebar customer count for specific customer
        function updateSidebarCustomerCount(customerId, count) {
            const customerItems = document.querySelectorAll('.customer-item');
            customerItems.forEach(item => {
                const customerName = item.querySelector('.customer-name').textContent.trim();
                const customer = customerManager.getAllCustomers().find(c => c.name === customerName);
                
                if (customer && customer.id === customerId) {
                    const countBadge = item.querySelector('.customer-count');
                    if (countBadge) {
                        countBadge.textContent = count;
                    }
                }
            });
        }
        
        // Refresh all assign dropdowns with latest customer data
        function refreshAssignDropdowns() {
            // This will be called when assign dropdowns are opened
            // No need to update all at once for performance
        }
        
        function updateCustomerSelect(customers) {
            const select = document.getElementById('customerSelect');
            select.innerHTML = '';
            
            // Add default customers
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = `${customer.id}:${customer.name}`;
                option.textContent = customer.name;
                select.appendChild(option);
            });
            
            // Ensure NAPO is always available
            if (!customers.find(c => c.id === 'napo')) {
                const napoOption = document.createElement('option');
                napoOption.value = 'napo:NAPO';
                napoOption.textContent = 'NAPO';
                select.insertBefore(napoOption, select.firstChild);
            }
        }
        
        function displayGroupedModels(models) {
            if (!models || models.length === 0) {
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>No Furniture Yet</h3>
                        <p>Upload your first furniture piece to get started!</p>
                        <br>
                        <button class="action-button" onclick="toggleUploadModal()">📤 Upload Furniture</button>
                    </div>
                `;
                return;
            }
            
            // Group models by customer
            const customerGroups = {};
            models.forEach(model => {
                const customerKey = model.customer_id || 'unassigned';
                const customerName = model.customer_name || 'Unassigned';
                
                if (!customerGroups[customerKey]) {
                    customerGroups[customerKey] = {
                        id: customerKey,
                        name: customerName,
                        models: [],
                        totalViews: 0,
                        totalSize: 0
                    };
                }
                
                customerGroups[customerKey].models.push(model);
                customerGroups[customerKey].totalViews += model.view_count || 0;
                customerGroups[customerKey].totalSize += model.file_size || 0;
            });
            
            let html = '<div class="customer-groups">';
            
            // Sort customers (NAPO first, then others)
            const sortedCustomers = Object.values(customerGroups).sort((a, b) => {
                if (a.id === 'napo') return -1;
                if (b.id === 'napo') return 1;
                return a.name.localeCompare(b.name);
            });
            
            sortedCustomers.forEach(customer => {
                html += `
                    <div class="customer-group" data-customer="${customer.id}">
                        <div class="customer-header" onclick="toggleCustomerGroup('${customer.id}')">
                            <div class="customer-name">
                                ${customer.name}
                                <span class="customer-badge">${customer.models.length}</span>
                            </div>
                            <div class="customer-stats">
                                ${customer.totalViews} views • ${formatFileSize(customer.totalSize)}
                                <span class="expand-icon">▼</span>
                            </div>
                        </div>
                        <div class="customer-content">
                            <div class="models-grid">
                                ${customer.models.map(model => generateModelCard(model)).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('modelsContainer').innerHTML = html;
        }
        
        function generateModelCard(model) {
            const viewUrl = `https://newfurniture.live/view?id=${model.id}`;
            const modelUrl = model.cloudinary_url || `/api/model/${model.id}`;
            
            return `
                <div class="model-card">
                    <div class="model-preview">
                        <model-viewer
                            class="model-viewer"
                            src="${modelUrl}"
                            alt="${model.title || 'Furniture Piece'}"
                            camera-controls
                            auto-rotate
                            auto-rotate-delay="2000"
                            rotation-per-second="15deg"
                            shadow-intensity="1"
                            camera-orbit="45deg 55deg auto"
                            loading="eager"
                            poster=""
                            environment-image="neutral"
                            exposure="1">
                            <div slot="progress-bar" style="display: none;"></div>
                        </model-viewer>
                    </div>
                    
                    <div class="model-info">
                        <div class="model-title">${model.title || 'Untitled'}</div>
                        <div class="model-description">${model.description || 'No description provided'}</div>
                        
                        <div class="model-meta">
                            <span class="model-id" style="display: none;">${model.id}</span>
                            <span>${formatDate(model.upload_date)}</span>
                        </div>
                        
                        <div class="model-stats">
                            <div class="stat-item">
                                <div class="stat-value">${model.view_count || 0}</div>
                                <div class="stat-label">Views</div>
                            </div>
                        </div>
                        
                        <div class="model-actions">
                            <a href="/view?id=${model.id}" target="_blank" class="action-button">
                                👁️ View AR
                            </a>
                            <button class="action-button" onclick="copyToClipboard('${viewUrl}', this)">
                                📋 Copy Link
                            </button>
                            <div class="assign-dropdown">
                                <button class="action-button assign-button" onclick="toggleAssignDropdown(this, '${model.id}', '${model.customer_id}', '${model.customer_name}')">
                                    🏷️ Assign
                                </button>
                                <div class="assign-dropdown-content">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                            <button class="action-button delete" onclick="deleteModel('${model.id}', '${model.cloudinary_public_id}')">
                                🗑️ Remove
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function toggleCustomerGroup(customerId) {
            const group = document.querySelector(`[data-customer="${customerId}"]`);
            group.classList.toggle('collapsed');
        }
        
        function deleteModel(id, cloudinaryPublicId) {
            deleteTarget = { id, cloudinaryPublicId };
            
            if (confirm('Are you sure you want to delete this model?')) {
                // Find the delete button and show loading state
                const deleteButton = document.querySelector(`button[onclick*="${id}"]`);
                if (deleteButton) {
                    deleteButton.disabled = true;
                    deleteButton.innerHTML = '<span class="loading-spinner"></span> Removing...';
                    deleteButton.style.opacity = '0.7';
                }
                confirmDelete();
            }
        }
        
        async function confirmDelete() {
            try {
                const response = await fetch('/api/models', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(deleteTarget)
                });
                
                if (!response.ok) throw new Error('Failed to delete model');
                
                // Reload models
                loadModels();
                
            } catch (error) {
                alert('Error deleting model: ' + error.message);
                
                // Reset button state on error
                if (deleteTarget) {
                    const deleteButton = document.querySelector(`button[onclick*="${deleteTarget.id}"]`);
                    if (deleteButton) {
                        deleteButton.disabled = false;
                        deleteButton.innerHTML = '🗑️ Remove';
                        deleteButton.style.opacity = '1';
                    }
                }
            }
        }
        
        
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }
        
        function formatFileSize(bytes) {
            if (!bytes) return '0 MB';
            const mb = bytes / (1024 * 1024);
            if (mb < 1) {
                const kb = bytes / 1024;
                return kb.toFixed(1) + ' KB';
            }
            return mb.toFixed(1) + ' MB';
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        let selectedFile = null;

        // Upload modal functions
        function toggleUploadModal() {
            document.getElementById('uploadModal').style.display = 'flex';
            setupDragAndDrop();
        }
        
        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
            document.getElementById('uploadForm').reset();
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressPercentage').textContent = '0%';
            selectedFile = null;
            hideFilePreview();
        }
        
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            
            dropZone.onclick = () => fileInput.click();
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, handleDragEnter, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, handleDragLeave, false);
            });

            dropZone.addEventListener('drop', handleFileDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);
        }
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function handleDragEnter(e) {
            document.getElementById('dropZone').classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            document.getElementById('dropZone').classList.remove('drag-over');
        }
        
        function handleFileDrop(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }
        
        function handleFile(file) {
            if (!file.name.match(/\.(glb|gltf)$/i)) {
                alert('Please select a GLB or GLTF file');
                return;
            }
            
            if (file.size > 100 * 1024 * 1024) {
                alert('File size must be less than 100MB');
                return;
            }
            
            selectedFile = file;
            showFilePreview(file);
            
            // Auto-fill title
            if (!document.getElementById('titleInput').value) {
                document.getElementById('titleInput').value = file.name.replace(/\.(glb|gltf)$/i, '');
            }
        }
        
        function showFilePreview(file) {
            document.getElementById('previewFileName').textContent = file.name;
            document.getElementById('previewFileSize').textContent = formatFileSize(file.size);
            document.getElementById('filePreviewContainer').style.display = 'block';
            document.getElementById('dropZone').style.display = 'none';
        }
        
        function hideFilePreview() {
            document.getElementById('filePreviewContainer').style.display = 'none';
            document.getElementById('dropZone').style.display = 'block';
        }
        
        function removeFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            hideFilePreview();
        }
        
        function formatFileSize(bytes) {
            const mb = bytes / (1024 * 1024);
            if (mb < 1) {
                return (bytes / 1024).toFixed(1) + ' KB';
            }
            return mb.toFixed(1) + ' MB';
        }
        
        // Handle upload form
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!selectedFile) {
                alert('Please select a furniture file');
                return;
            }
            
            const titleInput = document.getElementById('titleInput');
            const descriptionInput = document.getElementById('descriptionInput');
            const customerSelect = document.getElementById('customerSelect');
            
            // Parse customer selection
            const [customerId, customerName] = customerSelect.value.split(':');
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('title', titleInput.value || selectedFile.name.replace(/\.(glb|gltf)$/i, ''));
            formData.append('description', descriptionInput.value || '');
            formData.append('customerId', customerId);
            formData.append('customerName', customerName);
            
            // Show progress
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('uploadButton').disabled = true;
            document.getElementById('uploadStatus').textContent = 'Preparing upload...';
            
            try {
                // Enhanced progress simulation with different stages
                let progress = 0;
                let stage = 0;
                const stages = ['Preparing upload...', 'Uploading furniture...', 'Processing file...', 'Finalizing...'];
                
                const progressInterval = setInterval(() => {
                    progress += 5;
                    if (progress <= 90) {
                        document.getElementById('progressBar').style.width = progress + '%';
                        document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
                        
                        // Update stage text
                        const newStage = Math.floor(progress / 25);
                        if (newStage !== stage && stages[newStage]) {
                            stage = newStage;
                            document.getElementById('uploadStatus').textContent = stages[stage];
                        }
                    }
                }, 150);
                
                const response = await fetch('/api/upload-simple', {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercentage').textContent = '100%';
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Upload failed');
                }
                
                const result = await response.json();
                document.getElementById('uploadStatus').textContent = '✅ Upload successful!';
                
                // Close modal and refresh models after 2 seconds
                setTimeout(() => {
                    closeUploadModal();
                    loadModels();
                }, 2000);
                
            } catch (error) {
                document.getElementById('uploadStatus').textContent = '❌ Upload failed: ' + error.message;
                document.getElementById('uploadButton').disabled = false;
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('progressPercentage').textContent = '0%';
            }
        });
        
        // Auto-refresh every 30 seconds
        setInterval(loadModels, 30000);
        
        // Centralized Customer Data Management
        class CustomerDataManager {
            constructor() {
                this.customers = new Map();
                this.listeners = new Set();
            }
            
            // Add or update customer
            setCustomer(customer) {
                const existed = this.customers.has(customer.id);
                this.customers.set(customer.id, customer);
                
                if (existed) {
                    this.notifyListeners('customerUpdated', customer);
                } else {
                    this.notifyListeners('customerAdded', customer);
                }
            }
            
            // Get customer by ID
            getCustomer(customerId) {
                return this.customers.get(customerId);
            }
            
            // Get all customers as array
            getAllCustomers() {
                return Array.from(this.customers.values()).sort((a, b) => a.name.localeCompare(b.name));
            }
            
            // Update customer count
            updateCustomerCount(customerId, count) {
                const customer = this.customers.get(customerId);
                if (customer) {
                    customer.count = count;
                    this.notifyListeners('customerCountUpdated', customer);
                }
            }
            
            // Check if customer exists
            hasCustomer(customerId) {
                return this.customers.has(customerId);
            }
            
            // Add event listener
            addListener(callback) {
                this.listeners.add(callback);
            }
            
            // Remove event listener
            removeListener(callback) {
                this.listeners.delete(callback);
            }
            
            // Notify all listeners of changes
            notifyListeners(event, data) {
                this.listeners.forEach(listener => {
                    try {
                        listener(event, data);
                    } catch (error) {
                        console.error('Customer data listener error:', error);
                    }
                });
            }
            
            // Load customers from API
            async loadFromAPI() {
                try {
                    const response = await fetch('/api/customers');
                    if (!response.ok) throw new Error('Failed to load customers');
                    
                    const data = await response.json();
                    data.customers.forEach(customer => {
                        this.customers.set(customer.id, customer);
                    });
                    
                    this.notifyListeners('customersLoaded', this.getAllCustomers());
                } catch (error) {
                    console.error('Error loading customers:', error);
                }
            }
        }
        
        // Global customer manager instance
        const customerManager = new CustomerDataManager();
        
        // Initialize customer data manager listeners and start initialization
        customerManager.addListener((event, data) => {
            switch(event) {
                case 'customersLoaded':
                case 'customerAdded':
                case 'customerUpdated':
                    // Update sidebar customer list
                    updateSidebarCustomers(customerManager.getAllCustomers());
                    // Update assign dropdowns
                    refreshAssignDropdowns();
                    // Update upload modal dropdown
                    updateCustomerSelect(customerManager.getAllCustomers());
                    break;
                    
                case 'customerCountUpdated':
                    // Update sidebar counts
                    updateSidebarCustomerCount(data.id, data.count);
                    break;
            }
        });
        
        // Now initialize customers (after customerManager is ready)
        initializeCustomers();
        
        // Sidebar functionality
        let currentCustomerFilter = null;
        let searchQuery = '';
        let allCustomers = []; // Keep for backward compatibility
        
        
        function updateSidebarCustomers(customers) {
            allCustomers = customers;
            const customerList = document.getElementById('customerList');
            customerList.innerHTML = '';
            
            // Add "All Furniture" option
            const allItem = document.createElement('li');
            allItem.className = `customer-item ${currentCustomerFilter === null ? 'active' : ''}`;
            allItem.innerHTML = `
                <div class="customer-item-content">
                    <span class="customer-name">All Furniture</span>
                    <span class="customer-count">${customers.reduce((sum, c) => sum + c.count, 0)}</span>
                </div>
            `;
            allItem.onclick = () => filterByCustomer(null);
            customerList.appendChild(allItem);
            
            // Add "Unassigned" option - only show if there are unassigned items
            const unassignedCustomer = customers.find(c => c.id === 'unassigned');
            const unassignedCount = unassignedCustomer?.count || 0;
            
            // Only show Unassigned section if there are unassigned items
            if (unassignedCount > 0) {
                const unassignedItem = document.createElement('li');
                unassignedItem.className = `customer-item ${currentCustomerFilter === 'unassigned' ? 'active' : ''}`;
                unassignedItem.innerHTML = `
                    <div class="customer-item-content">
                        <span class="customer-name">Unassigned</span>
                        <span class="customer-count">${unassignedCount}</span>
                    </div>
                `;
                unassignedItem.onclick = () => filterByCustomer('unassigned', 'Unassigned');
                customerList.appendChild(unassignedItem);
            } else if (currentCustomerFilter === 'unassigned') {
                // If currently filtering by unassigned but no unassigned items exist, reset to "All"
                filterByCustomer(null);
            }
            
            console.log('Debug: Customers from API:', customers);
            console.log('Debug: Unassigned customer found:', unassignedCustomer);
            console.log('Debug: Unassigned count:', unassignedCount);
            
            // Add customer items (excluding unassigned which we show separately)
            customers.filter(customer => customer.id !== 'unassigned').forEach(customer => {
                const item = document.createElement('li');
                item.className = `customer-item ${currentCustomerFilter === customer.id ? 'active' : ''}`;
                item.innerHTML = `
                    <div class="customer-item-content">
                        <span class="customer-name">${customer.name}</span>
                        <span class="customer-count">${customer.count}</span>
                    </div>
                `;
                item.onclick = () => filterByCustomer(customer.id, customer.name);
                customerList.appendChild(item);
            });
            
            // Update sidebar stats (excluding unassigned from customer count)
            const actualCustomerCount = customers.filter(c => c.id !== 'unassigned').length;
            document.getElementById('sidebarTotalCustomers').textContent = actualCustomerCount;
        }
        
        function filterByCustomer(customerId, customerName = null) {
            currentCustomerFilter = customerId;
            
            // Update active state in sidebar
            document.querySelectorAll('.customer-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.customer-item').classList.add('active');
            
            // Filter displayed models
            const customerGroups = document.querySelectorAll('.customer-group');
            customerGroups.forEach(group => {
                const groupCustomerId = group.getAttribute('data-customer');
                if (currentCustomerFilter === null) {
                    // Show all
                    group.style.display = 'block';
                } else {
                    // Show only matching customer
                    group.style.display = groupCustomerId === currentCustomerFilter ? 'block' : 'none';
                }
            });
            
            // Update header to show current filter
            const headerTitle = document.querySelector('.header h1');
            if (customerId === null) {
                headerTitle.textContent = '⚙️ Admin Dashboard';
            } else {
                headerTitle.textContent = `⚙️ ${customerName || 'Customer'} Dashboard`;
            }
        }
        
        function handleSearch(query) {
            searchQuery = query.toLowerCase();
            
            // If no query, show current filter
            if (!searchQuery) {
                filterByCustomer(currentCustomerFilter);
                return;
            }
            
            // Search through all cards
            const modelCards = document.querySelectorAll('.model-card');
            const customerGroups = document.querySelectorAll('.customer-group');
            
            // First hide all groups
            customerGroups.forEach(group => {
                group.style.display = 'none';
            });
            
            // Show cards that match search
            let hasResults = false;
            modelCards.forEach(card => {
                const title = card.querySelector('.model-title')?.textContent?.toLowerCase() || '';
                const description = card.querySelector('.model-description')?.textContent?.toLowerCase() || '';
                const customerName = card.closest('.customer-group')?.querySelector('.customer-name')?.textContent?.toLowerCase() || '';
                
                const matches = title.includes(searchQuery) || 
                               description.includes(searchQuery) || 
                               customerName.includes(searchQuery);
                
                if (matches) {
                    hasResults = true;
                    // Show the parent group
                    const group = card.closest('.customer-group');
                    if (group) {
                        group.style.display = 'block';
                    }
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            if (!hasResults) {
                // Show empty state in main area
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>No Results Found</h3>
                        <p>No furniture matches "${query}"</p>
                    </div>
                `;
            }
        }
        
        function showAddCustomerForm() {
            document.getElementById('addCustomerForm').style.display = 'block';
            document.getElementById('newCustomerName').focus();
        }
        
        function hideAddCustomerForm() {
            document.getElementById('addCustomerForm').style.display = 'none';
            document.getElementById('newCustomerName').value = '';
        }
        
        function handleCustomerNameKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                saveNewCustomer();
            } else if (event.key === 'Escape') {
                event.preventDefault();
                hideAddCustomerForm();
            }
        }
        
        async function saveNewCustomer() {
            const customerName = document.getElementById('newCustomerName').value.trim();
            if (!customerName) return;
            
            try {
                hideAddCustomerForm();
                
                // Create customer ID from name (simple slug)
                const customerId = customerName.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
                
                // Check if already exists in centralized manager
                if (customerManager.hasCustomer(customerId)) {
                    alert('Customer already exists!');
                    return;
                }
                
                // Add to centralized customer manager
                customerManager.setCustomer({
                    id: customerId,
                    name: customerName,
                    count: 0
                });
                
            } catch (error) {
                alert('Failed to add customer: ' + error.message);
            }
        }
        
        // Update the existing loadCustomers function to also update sidebar
        const originalLoadCustomers = loadCustomers;
        loadCustomers = async function() {
            await originalLoadCustomers();
            
            // Also fetch for sidebar
            try {
                const response = await fetch('/api/customers');
                if (response.ok) {
                    const data = await response.json();
                    updateSidebarCustomers(data.customers);
                }
            } catch (error) {
                console.error('Error loading customers for sidebar:', error);
            }
        };
        
        // Update the existing loadModels function to also update sidebar stats
        const originalLoadModels = loadModels;
        loadModels = async function() {
            await originalLoadModels();
            
            // Update sidebar stats
            try {
                const response = await fetch('/api/models');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('sidebarTotalModels').textContent = data.stats.totalModels || 0;
                    document.getElementById('sidebarTotalViews').textContent = data.stats.totalViews || 0;
                }
            } catch (error) {
                console.error('Error updating sidebar stats:', error);
            }
        };
        
        
        function updateCustomerBadges() {
            document.querySelectorAll('.customer-group').forEach(group => {
                const badge = group.querySelector('.customer-badge');
                const cards = group.querySelectorAll('.model-card');
                if (badge) {
                    badge.textContent = cards.length;
                }
            });
        }
        
        // Assign Dropdown Functions
        function toggleAssignDropdown(button, modelId, currentCustomerId, currentCustomerName) {
            // Close any other open dropdowns
            document.querySelectorAll('.assign-dropdown.show').forEach(dropdown => {
                if (dropdown !== button.parentNode) {
                    dropdown.classList.remove('show');
                }
            });
            
            const dropdown = button.parentNode;
            const content = dropdown.querySelector('.assign-dropdown-content');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                return;
            }
            
            // Populate dropdown with customers
            populateAssignDropdown(content, modelId, currentCustomerId, currentCustomerName);
            dropdown.classList.add('show');
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!dropdown.contains(e.target)) {
                        dropdown.classList.remove('show');
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        }
        
        function populateAssignDropdown(content, modelId, currentCustomerId, currentCustomerName) {
            content.innerHTML = '';
            
            // Show current assignment
            if (currentCustomerId && currentCustomerName) {
                const currentOption = document.createElement('div');
                currentOption.className = 'assign-option current';
                currentOption.innerHTML = `✓ Currently: ${currentCustomerName}`;
                content.appendChild(currentOption);
            }
            
            // Add all customers from centralized manager
            const customers = customerManager.getAllCustomers();
            customers.forEach(customer => {
                if (customer.id !== currentCustomerId) {
                    const option = document.createElement('div');
                    option.className = 'assign-option';
                    option.textContent = customer.name;
                    option.onclick = () => assignFurnitureToCustomer(modelId, customer.id, customer.name);
                    content.appendChild(option);
                }
            });
            
            // Add "Create New Customer" option
            const newOption = document.createElement('div');
            newOption.className = 'assign-option new-customer';
            newOption.innerHTML = '+ Create New Customer';
            newOption.onclick = () => assignToNewCustomer(modelId);
            content.appendChild(newOption);
        }
        
        async function assignFurnitureToCustomer(modelId, customerId, customerName) {
            try {
                // Close dropdown
                document.querySelectorAll('.assign-dropdown.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                
                // No confirmation needed - just assign directly
                
                // Update database via API
                const response = await fetch('/api/assign', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ modelId, customerId, customerName })
                });
                
                if (!response.ok) {
                    const responseText = await response.text();
                    console.error('Assignment API Error Response:', responseText);
                    
                    try {
                        const error = JSON.parse(responseText);
                        throw new Error(error.error || 'Assignment failed');
                    } catch (jsonError) {
                        throw new Error(`API returned non-JSON response: ${responseText.substring(0, 100)}...`);
                    }
                }
                
                const responseText = await response.text();
                console.log('Assignment API Success Response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (jsonError) {
                    console.error('Success response is not valid JSON:', responseText);
                    throw new Error(`API returned non-JSON success response: ${responseText.substring(0, 100)}...`);
                }
                
                // Update UI immediately
                updateModelCardAssignment(modelId, customerId, customerName);
                
                alert(`✅ Furniture assigned to ${customerName}!`);
                
                // Refresh data to ensure consistency
                loadModels();
                loadCustomers();
                
            } catch (error) {
                console.error('Assignment error:', error);
                alert('Failed to assign furniture: ' + error.message);
            }
        }
        
        function updateModelCardAssignment(modelId, customerId, customerName) {
            // Find the model card
            const modelCard = Array.from(document.querySelectorAll('.model-card')).find(card => 
                card.querySelector('.model-id').textContent === modelId
            );
            
            if (!modelCard) return;
            
            // Find or create target customer group
            let targetGroup = document.querySelector(`[data-customer="${customerId}"]`);
            
            if (!targetGroup) {
                // Create new customer group
                const groupsContainer = document.querySelector('.customer-groups');
                targetGroup = document.createElement('div');
                targetGroup.className = 'customer-group';
                targetGroup.setAttribute('data-customer', customerId);
                targetGroup.innerHTML = `
                    <div class="customer-header" onclick="toggleCustomerGroup('${customerId}')">
                        <div class="customer-name">
                            ${customerName}
                            <span class="customer-badge">0</span>
                        </div>
                        <div class="customer-stats">
                            0 views • 0 B
                            <span class="expand-icon">▼</span>
                        </div>
                    </div>
                    <div class="customer-content">
                        <div class="models-grid">
                        </div>
                    </div>
                `;
                
                // Insert in alphabetical order
                const existingGroups = Array.from(groupsContainer.children);
                let inserted = false;
                for (let group of existingGroups) {
                    const groupName = group.querySelector('.customer-name')?.textContent.trim() || '';
                    if (customerName.localeCompare(groupName) < 0) {
                        groupsContainer.insertBefore(targetGroup, group);
                        inserted = true;
                        break;
                    }
                }
                if (!inserted) {
                    groupsContainer.appendChild(targetGroup);
                }
            }
            
            // Move the card
            const targetGrid = targetGroup.querySelector('.models-grid');
            targetGrid.appendChild(modelCard);
            
            // Update assign button to reflect new assignment
            const assignButton = modelCard.querySelector('.assign-button');
            assignButton.setAttribute('onclick', `toggleAssignDropdown(this, '${modelId}', '${customerId}', '${customerName}')`);
            
            // Update customer badges
            updateCustomerBadges();
        }
        
        async function assignToNewCustomer(modelId) {
            const customerName = prompt('Enter new customer name:');
            if (!customerName?.trim()) return;
            
            const customerId = customerName.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
            
            // Check if already exists in centralized manager
            if (customerManager.hasCustomer(customerId)) {
                alert('Customer already exists!');
                return;
            }
            
            // Add to centralized customer manager (this will trigger all UI updates)
            customerManager.setCustomer({
                id: customerId,
                name: customerName,
                count: 0
            });
            
            // Now assign to this customer
            await assignFurnitureToCustomer(modelId, customerId, customerName);
        }

        // User Management Functions
        function toggleUserManagement() {
            const section = document.getElementById('userManagementSection');
            const userList = document.getElementById('userList');
            const addUserButton = document.getElementById('addUserButtonContainer');
            const toggle = document.getElementById('userManagementToggle');
            
            if (userList.classList.contains('expanded')) {
                userList.classList.remove('expanded');
                addUserButton.style.maxHeight = '0';
                toggle.style.transform = 'rotate(0deg)';
            } else {
                userList.classList.add('expanded');
                addUserButton.style.maxHeight = '80px';
                toggle.style.transform = 'rotate(180deg)';
                loadUsers(); // Load users when expanding
            }
        }
        
        function toggleUserModal() {
            document.getElementById('userModal').style.display = 'flex';
        }
        
        async function loadUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = '<div class="loading-users" style="padding: 20px; text-align: center; color: #7d8590;">Loading users...</div>';
            
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #f85149;">Failed to load users</div>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #f85149;">Error loading users</div>';
            }
        }
        
        function displayUsers(users) {
            const userList = document.getElementById('userList');
            
            if (users.length === 0) {
                userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #7d8590;">No users found</div>';
                return;
            }
            
            const userHTML = users.map(user => {
                const isAdmin = user.username === 'admin' || user.role === 'admin';
                return `
                    <div class="user-item">
                        <div class="user-item-header">
                            <span class="user-name">${user.username}</span>
                            <span class="user-role">${user.role}</span>
                        </div>
                        <div class="user-details">
                            ${user.customer_name ? `Customer: ${user.customer_name}` : ''}
                            ${user.total_views ? `• Views: ${user.total_views}` : ''}
                        </div>
                        <div class="user-actions">
                            <button class="user-action-btn" onclick="openUserEditModal('${user.id}', '${user.username}', '${user.role}', '${user.customer_id || ''}', '${user.customer_name || ''}', ${user.is_active}, ${isAdmin})" title="Manage User">
                                ⚙️
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            userList.innerHTML = userHTML;
        }
        
        // Global variables for user edit modal
        let currentEditUserId = null;
        let currentEditUserData = {};
        
        function openUserEditModal(userId, username, role, customerId, customerName, isActive, isAdmin) {
            currentEditUserId = userId;
            currentEditUserData = {
                username,
                role,
                customerId,
                customerName,
                isActive,
                isAdmin
            };
            
            // Update modal title
            document.getElementById('editModalTitle').textContent = `⚙️ Manage User: ${username}`;
            
            // Show/hide customer info section
            const customerSection = document.getElementById('customerInfoSection');
            if (role === 'customer') {
                customerSection.style.display = 'block';
                document.getElementById('editCustomerId').value = customerId || '';
                document.getElementById('editCustomerName').value = customerName || '';
            } else {
                customerSection.style.display = 'none';
            }
            
            // Update status button
            const statusBtn = document.getElementById('toggleStatusBtn');
            const protectedNote = document.getElementById('protectedUserNote');
            
            if (isAdmin) {
                statusBtn.style.display = 'none';
                protectedNote.style.display = 'block';
            } else {
                statusBtn.style.display = 'block';
                protectedNote.style.display = 'none';
                statusBtn.textContent = isActive ? 'Deactivate Account' : 'Activate Account';
                statusBtn.className = isActive ? 'modal-button danger' : 'modal-button primary';
            }
            
            // Clear password field
            document.getElementById('editNewPassword').value = '';
            
            // Show modal
            document.getElementById('userEditModal').style.display = 'flex';
        }
        
        function closeUserEditModal() {
            document.getElementById('userEditModal').style.display = 'none';
            currentEditUserId = null;
            currentEditUserData = {};
        }
        
        function resetUserPassword() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('editNewPassword').value = password;
        }
        
        async function toggleUserStatus() {
            if (!currentEditUserId) return;
            
            const action = currentEditUserData.isActive ? 'deactivate' : 'activate';
            if (!confirm(`Are you sure you want to ${action} user "${currentEditUserData.username}"?`)) return;
            
            try {
                const response = await fetch(`/api/users/${currentEditUserId}/toggle`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    currentEditUserData.isActive = !currentEditUserData.isActive;
                    const statusBtn = document.getElementById('toggleStatusBtn');
                    statusBtn.textContent = currentEditUserData.isActive ? 'Deactivate Account' : 'Activate Account';
                    statusBtn.className = currentEditUserData.isActive ? 'modal-button danger' : 'modal-button primary';
                    
                    loadUsers(); // Refresh the list
                    alert(`User ${action}d successfully`);
                } else {
                    alert('Failed to update user status');
                }
            } catch (error) {
                console.error('Error updating user status:', error);
                alert('Error updating user status');
            }
        }
        
        async function saveUserChanges() {
            if (!currentEditUserId) return;
            
            const newPassword = document.getElementById('editNewPassword').value.trim();
            const customerId = document.getElementById('editCustomerId').value.trim();
            const customerName = document.getElementById('editCustomerName').value.trim();
            
            try {
                let hasChanges = false;
                
                // Update password if provided
                if (newPassword) {
                    const passwordResponse = await fetch(`/api/users/${currentEditUserId}/password`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password: newPassword })
                    });
                    
                    if (!passwordResponse.ok) {
                        alert('Failed to update password');
                        return;
                    }
                    hasChanges = true;
                }
                
                // Update customer info if role is customer and fields have changed
                if (currentEditUserData.role === 'customer' && 
                    (customerId !== currentEditUserData.customerId || customerName !== currentEditUserData.customerName)) {
                    
                    const customerResponse = await fetch(`/api/users/${currentEditUserId}/customer`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            customerId: customerId || currentEditUserData.customerId,
                            customerName: customerName || currentEditUserData.customerName
                        })
                    });
                    
                    if (!customerResponse.ok) {
                        alert('Failed to update customer information');
                        return;
                    }
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    alert('User updated successfully!');
                    loadUsers(); // Refresh the list
                    closeUserEditModal();
                } else {
                    alert('No changes made');
                    closeUserEditModal();
                }
                
            } catch (error) {
                console.error('Error saving user changes:', error);
                alert('Error saving changes');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                // Clear session and redirect to login
                fetch('/api/logout', { method: 'POST' })
                    .then(() => {
                        window.location.href = '/';
                    })
                    .catch(() => {
                        // Even if logout API fails, redirect anyway
                        window.location.href = '/';
                    });
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            document.getElementById('userForm').reset();
            document.getElementById('customerFields').style.display = 'none';
        }

        // Show/hide customer fields based on role selection
        document.getElementById('newRole').addEventListener('change', function() {
            const customerFields = document.getElementById('customerFields');
            if (this.value === 'customer') {
                customerFields.style.display = 'block';
                document.getElementById('newCustomerId').required = true;
                document.getElementById('newCustomerName').required = true;
            } else {
                customerFields.style.display = 'none';
                document.getElementById('newCustomerId').required = false;
                document.getElementById('newCustomerName').required = false;
            }
        });

        // Handle user creation form submission
        document.getElementById('userForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const button = document.getElementById('createUserButton');
            const buttonText = button.querySelector('.button-text');
            
            // Get form data
            const formData = new FormData(e.target);
            const userData = {
                username: document.getElementById('newUsername').value,
                password: document.getElementById('newPassword').value,
                role: document.getElementById('newRole').value
            };

            // Add customer fields if role is customer
            if (userData.role === 'customer') {
                userData.customerId = document.getElementById('newCustomerId').value;
                userData.customerName = document.getElementById('newCustomerName').value;
            }

            // Show loading state
            button.disabled = true;
            buttonText.textContent = 'Creating User...';

            try {
                const response = await fetch('/api/create-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`User "${userData.username}" created successfully!\n\nLogin credentials:\nUsername: ${userData.username}\nPassword: ${userData.password}\nRole: ${userData.role}${userData.role === 'customer' ? `\nCustomer: ${userData.customerName}` : ''}`);
                    closeUserModal();
                    
                    // Refresh customer data if needed
                    if (typeof customerDataManager !== 'undefined') {
                        await customerDataManager.loadCustomers();
                    }
                } else {
                    alert('Failed to create user: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating user:', error);
                alert('Error creating user: ' + error.message);
            } finally {
                // Reset button state
                button.disabled = false;
                buttonText.textContent = 'Create User';
            }
        });
    </script>
</body>
</html>
