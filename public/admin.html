<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - newfurniture.live</title>
    <!-- Force deployment refresh -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 255, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #0a0c10 0%, #0d1117 50%, #111418 100%);
            color: #e6edf3;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="0.5" fill="%23ffffff" opacity="0.02"/><circle cx="75" cy="75" r="0.3" fill="%23ffffff" opacity="0.02"/><circle cx="50" cy="10" r="0.4" fill="%23ffffff" opacity="0.01"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>'),
                linear-gradient(180deg, rgba(88, 166, 255, 0.02) 0%, transparent 100%);
            pointer-events: none;
            z-index: -1;
        }
        
        .header {
            background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 2rem;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-button {
            background: rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            border: 1px solid rgba(240, 246, 252, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 14px;
        }
        
        .nav-button:hover {
            background: rgba(240, 246, 252, 0.15);
            border-color: rgba(240, 246, 252, 0.3);
            transform: translateY(-1px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            margin-left: 321px;
            margin-right: 40px;
            margin-top: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.9) 0%, rgba(30, 35, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.15);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.5), transparent);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
            border-color: rgba(88, 166, 255, 0.3);
        }
        
        .stat-label {
            color: #7d8590;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #e6edf3;
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-icon {
            float: right;
            font-size: 2rem;
            opacity: 0.4;
        }
        
        .models-section {
            margin-left: 321px;
            margin-right: 40px;
            margin-top: 40px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.9) 0%, rgba(30, 35, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.15);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            position: relative;
            overflow: hidden;
        }
        
        .models-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.6), rgba(120, 200, 255, 0.6), transparent);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e6edf3;
        }
        
        .refresh-button {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .refresh-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .model-card {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(30, 35, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                0 1px 0 rgba(255, 255, 255, 0.05) inset;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .model-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.4), transparent);
            z-index: 1;
        }
        
        .model-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 2px 0 rgba(88, 166, 255, 0.2) inset;
            border-color: rgba(88, 166, 255, 0.4);
        }
        
        .model-card:hover::before {
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.8), rgba(120, 200, 255, 0.6), transparent);
        }
        
        .model-preview {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, #0d1117 0%, #21262d 100%);
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .model-viewer {
            width: 100%;
            height: 100%;
        }
        
        .model-info {
            padding: 16px;
        }
        
        .model-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 8px;
        }
        
        .model-description {
            color: #7d8590;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .model-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #7d8590;
        }
        
        .model-id {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: rgba(240, 246, 252, 0.1);
            color: #79c0ff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .model-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #58a6ff;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #7d8590;
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .model-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 6px 10px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            background: rgba(240, 246, 252, 0.05);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            color: #e6edf3;
            display: inline-block;
            flex: 1;
            text-align: center;
        }
        
        .action-button:hover {
            border-color: rgba(88, 166, 255, 0.5);
            background: rgba(88, 166, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .action-button.delete {
            color: #f85149;
            border-color: rgba(248, 81, 73, 0.3);
            background: rgba(248, 81, 73, 0.1);
        }
        
        .action-button.delete:hover {
            background: rgba(248, 81, 73, 0.2);
            border-color: rgba(248, 81, 73, 0.5);
        }
        
        .action-button.variant-btn {
            background: rgba(255, 165, 0, 0.1);
            border-color: rgba(255, 165, 0, 0.3);
            color: #ffa500;
        }
        
        .action-button.variant-btn:hover {
            background: rgba(255, 165, 0, 0.2);
            border-color: rgba(255, 165, 0, 0.5);
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 6px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }
        
        
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            padding: 30px;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #e6edf3;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            background: rgba(240, 246, 252, 0.05);
            color: #e6edf3;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #58a6ff;
            background: rgba(240, 246, 252, 0.1);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .modal-button.primary {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            font-weight: 500;
        }
        
        .modal-button.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }
        
        .modal-button.secondary {
            background: rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            border: 1px solid rgba(240, 246, 252, 0.2);
        }
        
        .modal-button.secondary:hover {
            background: rgba(240, 246, 252, 0.15);
            border-color: rgba(240, 246, 252, 0.3);
        }
        
        .copy-button {
            cursor: pointer;
            color: #667eea;
            margin-left: 10px;
            font-size: 1.2rem;
        }
        
        .copy-button:hover {
            color: #5568d3;
        }
        
        /* Futuristic Upload Styles */
        .futuristic-upload {
            max-width: 500px !important;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.98) 0%, rgba(30, 35, 42, 0.95) 100%);
            border: 2px solid rgba(88, 166, 255, 0.2);
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        }
        
        .upload-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .upload-icon-container {
            display: flex;
            justify-content: center;
            margin-bottom: 12px;
        }
        
        .upload-icon-bg {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.2), rgba(120, 200, 255, 0.1));
            border: 2px solid rgba(88, 166, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: iconPulse 3s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(88, 166, 255, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(88, 166, 255, 0); }
        }
        
        .upload-icon {
            width: 32px;
            height: 32px;
            color: #58a6ff;
        }
        
        .upload-title {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #e6edf3, #58a6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .upload-subtitle {
            color: #7d8590;
            font-size: 0.95rem;
            font-weight: 400;
        }
        
        .futuristic-drop-zone {
            position: relative;
            margin-bottom: 15px;
        }
        
        .drop-zone-content {
            border: 2px dashed rgba(88, 166, 255, 0.3);
            border-radius: 16px;
            padding: 25px 15px;
            text-align: center;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.02), rgba(120, 200, 255, 0.01));
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .drop-zone-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(88, 166, 255, 0.1), transparent);
            border-radius: 16px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .drop-zone-content:hover {
            border-color: rgba(88, 166, 255, 0.5);
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.05), rgba(120, 200, 255, 0.02));
        }
        
        .drop-zone-content:hover::before {
            opacity: 1;
        }
        
        .drop-animation {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .drop-ring {
            width: 60px;
            height: 60px;
            border: 2px solid rgba(88, 166, 255, 0.3);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: ripple 2s ease-out infinite;
        }
        
        .drop-ring:nth-child(2) { animation-delay: 0.5s; }
        .drop-ring:nth-child(3) { animation-delay: 1s; }
        
        @keyframes ripple {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }
            100% {
                width: 80px;
                height: 80px;
                opacity: 0;
            }
        }
        
        .upload-text {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .primary-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e6edf3;
        }
        
        .secondary-text {
            font-size: 0.95rem;
            color: #7d8590;
        }
        
        .click-text {
            color: #58a6ff;
            font-weight: 500;
        }
        
        .format-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .format-badge {
            background: rgba(88, 166, 255, 0.1);
            color: #58a6ff;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(88, 166, 255, 0.2);
        }
        
        .size-limit {
            color: #7d8590;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .drag-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(120, 200, 255, 0.1));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        
        .futuristic-drop-zone.drag-over .drag-overlay {
            opacity: 1;
        }
        
        .drag-content {
            text-align: center;
            color: #58a6ff;
        }
        
        .drag-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 0.6s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .file-preview-container {
            margin-bottom: 25px;
        }
        
        .file-preview-card {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(120, 200, 255, 0.05));
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-icon {
            font-size: 2rem;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 4px;
        }
        
        .file-size {
            color: #7d8590;
            font-size: 0.9rem;
        }
        
        .remove-file-btn {
            background: rgba(248, 81, 73, 0.1);
            color: #f85149;
            border: 1px solid rgba(248, 81, 73, 0.3);
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .remove-file-btn:hover {
            background: rgba(248, 81, 73, 0.2);
        }
        
        .input-group {
            position: relative;
            margin-bottom: 15px;
        }
        
        .futuristic-input {
            width: 100%;
            background: rgba(240, 246, 252, 0.03);
            border: 1px solid rgba(240, 246, 252, 0.1);
            color: #e6edf3;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .futuristic-input:focus {
            outline: none;
            border-color: rgba(88, 166, 255, 0.5);
            background: rgba(240, 246, 252, 0.05);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }
        
        .futuristic-input.textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .input-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            width: 0;
            background: linear-gradient(90deg, #58a6ff, #79c0ff);
            transition: width 0.3s ease;
            border-radius: 1px;
        }
        
        .futuristic-input:focus + .input-line {
            width: 100%;
        }
        
        .futuristic-primary {
            position: relative;
            overflow: hidden;
        }
        
        .button-text {
            position: relative;
            z-index: 2;
        }
        
        .button-glow {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .futuristic-primary:hover .button-glow {
            left: 100%;
        }
        
        .upload-progress {
            margin-top: 25px;
        }
        
        .progress-label {
            color: #e6edf3;
            font-weight: 500;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .progress-track {
            flex: 1;
            height: 6px;
            background: rgba(240, 246, 252, 0.1);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #58a6ff, #79c0ff);
            border-radius: 3px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.5), transparent);
            opacity: 0;
            animation: progressGlow 2s ease-in-out infinite;
        }
        
        @keyframes progressGlow {
            0%, 100% { opacity: 0; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }
        
        .progress-percentage {
            color: #58a6ff;
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 40px;
        }
        
        .customer-select {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2358a6ff" d="M6 8L0 2h12L6 8z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 50px;
        }
        
        /* Customer Groups Styles */
        .customer-groups {
            margin-top: 30px;
        }
        
        .customer-group {
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.6), rgba(30, 35, 42, 0.5));
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .customer-group:hover {
            border-color: rgba(88, 166, 255, 0.2);
        }
        
        /* Sidebar Styles */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(13, 17, 23, 0.95) 0%, rgba(22, 27, 34, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(240, 246, 252, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        
        
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            text-align: center;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e6edf3;
            margin-bottom: 5px;
        }
        
        .sidebar-subtitle {
            font-size: 0.85rem;
            color: #7d8590;
        }
        
        .sidebar-search {
            padding: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .search-input {
            width: 100%;
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 12px;
            color: #e6edf3;
            padding: 12px 16px;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            border-color: rgba(88, 166, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }
        
        .search-input::placeholder {
            color: #7d8590;
        }
        
        .sidebar-stats {
            padding: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .sidebar-stats-title {
            font-size: 0.9rem;
            color: #7d8590;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .sidebar-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sidebar-stat-label {
            color: #e6edf3;
            font-size: 0.85rem;
        }
        
        .sidebar-stat-value {
            color: #58a6ff;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .sidebar-section {
            padding: 20px;
        }
        
        .sidebar-customers {
            padding: 20px;
            flex: 1;
        }
        
        .sidebar-customers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sidebar-customers-title {
            font-size: 0.9rem;
            color: #7d8590;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .add-customer-btn {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            color: #58a6ff;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-customer-btn:hover {
            background: rgba(88, 166, 255, 0.2);
        }
        
        .customer-list {
            list-style: none;
        }
        
        .customer-item {
            padding: 12px 16px;
            margin-bottom: 6px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            position: relative;
        }
        
        .customer-item:hover {
            background: rgba(240, 246, 252, 0.05);
            border-color: rgba(240, 246, 252, 0.1);
        }
        
        .customer-item.active {
            background: rgba(88, 166, 255, 0.1);
            border-color: rgba(88, 166, 255, 0.3);
        }
        
        .customer-item-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .customer-name {
            color: #e6edf3;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .customer-count {
            background: rgba(88, 166, 255, 0.2);
            color: #58a6ff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .main-content {
            margin-left: 321px;
            flex: 1;
        }
        
        .add-customer-form {
            display: none;
            padding: 10px;
            background: rgba(22, 27, 34, 0.8);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .add-customer-input {
            width: 100%;
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 8px;
            color: #e6edf3;
            padding: 8px 12px;
            font-size: 0.85rem;
            outline: none;
            margin-bottom: 8px;
        }
        
        .add-customer-actions {
            display: flex;
            gap: 8px;
        }
        
        .add-customer-save,
        .add-customer-cancel {
            flex: 1;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-customer-save {
            background: rgba(46, 160, 67, 0.2);
            border: 1px solid rgba(46, 160, 67, 0.4);
            color: #3fb950;
        }
        
        .add-customer-cancel {
            background: rgba(248, 81, 73, 0.2);
            border: 1px solid rgba(248, 81, 73, 0.4);
            color: #f85149;
        }
        
        
        
        /* Assign Dropdown */
        .assign-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .assign-button {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            color: #ffa500;
        }
        
        .assign-button:hover {
            background: rgba(255, 165, 0, 0.2);
            border-color: rgba(255, 165, 0, 0.5);
        }
        
        .assign-dropdown-content {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            min-width: 200px;
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.95) 0%, rgba(30, 35, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            padding: 8px 0;
            margin-bottom: 8px;
        }
        
        .assign-dropdown.show .assign-dropdown-content {
            display: block;
        }
        
        .assign-option {
            padding: 10px 16px;
            color: #e6edf3;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .assign-option:last-child {
            border-bottom: none;
        }
        
        .assign-option:hover {
            background: rgba(240, 246, 252, 0.1);
        }
        
        .assign-option.current {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            font-weight: 500;
        }
        
        .assign-option.new-customer {
            background: rgba(46, 160, 67, 0.1);
            color: #3fb950;
            border-top: 1px solid rgba(240, 246, 252, 0.1);
            font-weight: 500;
        }
        
        .assign-option.new-customer:hover {
            background: rgba(46, 160, 67, 0.2);
        }

        .customer-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(120, 200, 255, 0.05));
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .customer-header:hover {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(120, 200, 255, 0.08));
        }
        
        .customer-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e6edf3;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .customer-badge {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .customer-stats {
            color: #7d8590;
            font-size: 0.9rem;
        }
        
        .expand-icon {
            color: #58a6ff;
            transition: transform 0.3s ease;
        }
        
        .customer-group.collapsed .expand-icon {
            transform: rotate(-90deg);
        }
        
        .customer-content {
            padding: 30px;
            display: none;
        }
        
        .customer-group:not(.collapsed) .customer-content {
            display: block;
        }
        
        /* User Management Styles */
        .user-management-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .user-management-list.expanded {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.05);
            transition: background 0.2s ease;
        }
        
        .user-item:hover {
            background: rgba(240, 246, 252, 0.03);
        }
        
        .user-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .user-name {
            color: #e6edf3;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .user-role {
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user-details {
            font-size: 0.8rem;
            color: #7d8590;
            margin-bottom: 8px;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .user-item-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            color: #e6edf3;
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .user-role-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-role {
            color: #7d8590;
            font-size: 0.75rem;
            text-transform: capitalize;
        }
        
        .user-settings-btn {
            padding: 2px 4px;
            font-size: 0.7rem;
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 4px;
            background: rgba(88, 166, 255, 0.15);
            color: #58a6ff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .user-settings-btn:hover {
            background: rgba(88, 166, 255, 0.25);
            border-color: rgba(88, 166, 255, 0.5);
            transform: scale(1.1);
        }
        
        .user-views {
            color: #7d8590;
            font-size: 0.75rem;
            margin-top: 4px;
        }
        
        .edit-section {
            padding: 20px;
            margin-bottom: 15px;
            background: rgba(22, 27, 34, 0.6);
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 12px;
        }
        
        .section-title {
            color: #e6edf3;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .user-edit-sections {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Logout Section */
        .sidebar-logout {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid rgba(240, 246, 252, 0.1);
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.5) 0%, rgba(30, 35, 42, 0.3) 100%);
        }
        
        .logout-user-info {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }
        
        .logout-username {
            color: #e6edf3;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .logout-role {
            color: #7d8590;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .logout-button {
            width: 100%;
            padding: 10px;
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            color: #f85149;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .logout-button:hover {
            background: rgba(248, 81, 73, 0.2);
            border-color: rgba(248, 81, 73, 0.5);
            transform: translateY(-1px);
        }
        
        /* Modern File Upload Styles */
        .modern-file-upload {
            position: relative;
            border: 2px dashed rgba(88, 166, 255, 0.3);
            border-radius: 12px;
            padding: 30px 20px;
            background: rgba(13, 17, 23, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .modern-file-upload:hover {
            border-color: rgba(88, 166, 255, 0.6);
            background: rgba(88, 166, 255, 0.05);
            transform: translateY(-1px);
        }
        
        .modern-file-upload.drag-over {
            border-color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
            transform: scale(1.02);
        }
        
        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 2;
        }
        
        .upload-icon-modern {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.2), rgba(121, 192, 255, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: #58a6ff;
            transition: all 0.3s ease;
        }
        
        .modern-file-upload:hover .upload-icon-modern {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }
        
        .upload-text-modern {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .upload-primary {
            color: #e6edf3;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .upload-secondary {
            color: #7d8590;
            font-size: 0.85rem;
        }
        
        .upload-border {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .modern-file-upload:hover .upload-border {
            left: 100%;
        }
        
        .file-name-modern {
            margin-top: 15px;
            padding: 12px 16px;
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 8px;
            color: #58a6ff;
            font-size: 0.9rem;
            text-align: center;
            font-weight: 500;
        }
        
        /* Variant Display Styles */
        .model-variants {
            margin: 15px 0;
            padding: 12px;
            background: rgba(88, 166, 255, 0.05);
            border: 1px solid rgba(88, 166, 255, 0.2);
            border-radius: 8px;
        }
        
        .variants-label {
            color: #e6edf3;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .variants-circles {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .variant-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            position: relative;
        }
        
        .variant-circle:hover {
            transform: scale(1.2);
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .variant-circle.primary {
            border-color: #ffd700;
            border-width: 3px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .variant-circle.primary:hover {
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.7);
        }
        
        .variant-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .variant-delete {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .variant-wrapper:hover .variant-delete {
            display: flex;
        }
        
        .variant-delete:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }
        
        /* Variant Type Selection */
        .variant-type-options {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        
        .variant-type-option {
            flex: 1;
            padding: 15px;
            border: 2px solid rgba(88, 166, 255, 0.2);
            border-radius: 10px;
            background: rgba(13, 17, 23, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .variant-type-option:hover {
            border-color: rgba(88, 166, 255, 0.5);
            background: rgba(88, 166, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .variant-type-option.active {
            border-color: #58a6ff;
            background: rgba(88, 166, 255, 0.15);
            box-shadow: 0 4px 15px rgba(88, 166, 255, 0.3);
        }
        
        .type-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .type-label {
            color: #e6edf3;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }
        
        .type-desc {
            color: #7d8590;
            font-size: 0.8rem;
        }
        
        .variant-type-option.active .type-label {
            color: #58a6ff;
        }
        
        /* Page System Styles */
        .page {
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }
        
        /* Content wrapper for pages */
        .dashboard-content {
            padding: 30px;
        }
        
        .sidebar-nav-title {
            padding: 15px 20px 10px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #7d8590;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .sidebar-nav-links {
            padding: 0 10px;
        }
        
        .sidebar-nav-link {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 4px;
            border: none;
            background: transparent;
            color: #e6edf3;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .sidebar-nav-link:hover {
            background: rgba(88, 166, 255, 0.1);
            color: #58a6ff;
        }
        
        .sidebar-nav-link.active {
            background: rgba(88, 166, 255, 0.15);
            color: #58a6ff;
            font-weight: 600;
        }
        
        .nav-icon {
            margin-right: 12px;
            font-size: 1.1em;
        }
        
        .nav-label {
            flex: 1;
        }
        
        .header-subtitle {
            color: #7d8590;
            font-size: 0.9rem;
            margin-top: 4px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        /* Filters Section */
        .filters-section {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(13, 17, 23, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(240, 246, 252, 0.1);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .filter-label {
            color: #7d8590;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .filter-select,
        .filter-input {
            padding: 8px 12px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 6px;
            background: rgba(13, 17, 23, 0.8);
            color: #e6edf3;
            font-size: 0.9rem;
            min-width: 140px;
        }
        
        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.2);
        }
        
        .filter-input {
            min-width: 200px;
        }
        
        /* Images Grid */
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .image-card {
            background: rgba(13, 17, 23, 0.6);
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        .image-card:hover {
            border-color: rgba(88, 166, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .image-preview {
            width: 100%;
            height: 160px;
            background: rgba(240, 246, 252, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .image-info {
            padding: 15px;
        }
        
        .image-title {
            color: #e6edf3;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        
        .image-meta {
            color: #7d8590;
            font-size: 0.8rem;
            margin-bottom: 4px;
        }
        
        .image-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
        }
        
        .image-type-badge {
            background: rgba(88, 166, 255, 0.15);
            color: #58a6ff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .image-delete-btn {
            background: none;
            border: none;
            color: #f85149;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .image-delete-btn:hover {
            background: rgba(248, 81, 73, 0.1);
        }
        
        /* Users Section */
        .users-section {
            background: rgba(13, 17, 23, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(240, 246, 252, 0.1);
            overflow: hidden;
        }
        
        .user-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(240, 246, 252, 0.1);
            transition: all 0.2s ease;
        }
        
        .user-card:last-child {
            border-bottom: none;
        }
        
        .user-card:hover {
            background: rgba(88, 166, 255, 0.05);
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(88, 166, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 15px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            color: #e6edf3;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .user-role {
            color: #7d8590;
            font-size: 0.85rem;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .user-action-btn {
            padding: 6px 12px;
            border: 1px solid rgba(240, 246, 252, 0.2);
            border-radius: 6px;
            background: transparent;
            color: #e6edf3;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }
        
        .user-action-btn:hover {
            border-color: #58a6ff;
            color: #58a6ff;
        }
        
        .user-action-btn.danger:hover {
            border-color: #f85149;
            color: #f85149;
        }
        
        /* Customer Logo Management Styles */
        .customer-logo-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 8px;
            background: rgba(13, 17, 23, 0.3);
        }
        
        .subsection-title {
            color: #7d8590;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .logo-management {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .current-logo {
            width: 80px;
            height: 80px;
            border: 2px dashed rgba(240, 246, 252, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: rgba(240, 246, 252, 0.02);
        }
        
        .current-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .logo-placeholder {
            color: #7d8590;
            font-size: 0.8rem;
            text-align: center;
            padding: 10px;
        }
        
        .logo-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }
        
        .logo-actions .action-button {
            padding: 8px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    
    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Admin Panel</div>
                <div class="sidebar-subtitle">Furniture Management</div>
            </div>
            
            <div class="sidebar-search">
                <input type="text" class="search-input" placeholder="Search furniture or customers..." 
                       oninput="handleSearch(this.value)" />
            </div>
            
            <!-- Upload Button -->
            <div style="padding: 20px; border-bottom: 1px solid rgba(240, 246, 252, 0.1);">
                <button onclick="toggleUploadModal()" class="modal-button primary" style="width: 100%; padding: 12px; font-size: 0.9rem; background: rgba(88, 166, 255, 0.15); border: 1px solid rgba(88, 166, 255, 0.3); color: #58a6ff; border-radius: 12px; transition: all 0.2s ease;">
                    📤 Upload Furniture
                </button>
            </div>
            
            <!-- Navigation Links -->
            <div class="sidebar-section">
                <div class="sidebar-nav-title">🧭 Pages</div>
                <div class="sidebar-nav-links">
                    <button class="sidebar-nav-link active" data-page="dashboard" onclick="navigateToPage('dashboard')">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-label">Dashboard</span>
                    </button>
                    <button class="sidebar-nav-link" data-page="images" onclick="navigateToPage('images')">
                        <span class="nav-icon">🖼️</span>
                        <span class="nav-label">Images Library</span>
                    </button>
                    <button class="sidebar-nav-link" data-page="users" onclick="navigateToPage('users')">
                        <span class="nav-icon">👥</span>
                        <span class="nav-label">User Management</span>
                    </button>
                </div>
            </div>
            
            <!-- Customers Section -->
            <div class="sidebar-customers" style="margin-top: 5px;">
                <div class="sidebar-customers-header">
                    <span class="sidebar-customers-title">Customers</span>
                    <button class="add-customer-btn" onclick="openUserModalForCustomer()">+ Add</button>
                </div>
                
                <!-- Add Customer Form -->
                <div class="add-customer-form" id="addCustomerForm">
                    <input type="text" class="add-customer-input" placeholder="Customer name" id="addCustomerNameInput" onkeydown="handleCustomerNameKeydown(event)" />
                    <div class="add-customer-actions">
                        <button class="add-customer-save" onclick="saveNewCustomer()">Save</button>
                        <button class="add-customer-cancel" onclick="hideAddCustomerForm()">Cancel</button>
                    </div>
                </div>
                
                <ul class="customer-list" id="customerList">
                    <!-- Customer items will be populated here -->
                </ul>
            </div>
            
            <!-- Quick Stats moved to bottom -->
            <div class="sidebar-stats">
                <div class="sidebar-stats-title">Quick Stats</div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Total Furniture</span>
                    <span class="sidebar-stat-value" id="sidebarTotalModels">-</span>
                </div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Customers</span>
                    <span class="sidebar-stat-value" id="sidebarTotalCustomers">-</span>
                </div>
                <div class="sidebar-stat-item">
                    <span class="sidebar-stat-label">Total Views</span>
                    <span class="sidebar-stat-value" id="sidebarTotalViews">-</span>
                </div>
            </div>
            
            <!-- Logout Section -->
            <div class="sidebar-logout">
                <div class="logout-user-info">
                    <span class="logout-username" id="loggedInUsername">admin</span>
                    <span class="logout-role">Administrator</span>
                </div>
                <button class="logout-button" onclick="logout()">Sign Out</button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <div class="page" id="dashboardPage" style="display: block;">
                <div class="header">
                    <div class="header-content">
                        <h1>🏠 Dashboard</h1>
                        <p class="header-subtitle">Furniture management overview</p>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📦</div>
                        <div class="stat-label">Total Furniture</div>
                        <div class="stat-value" id="totalModels">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">👁️</div>
                        <div class="stat-label">Total Views</div>
                        <div class="stat-value" id="totalViews">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💾</div>
                        <div class="stat-label">Storage Used</div>
                        <div class="stat-value" id="totalSize">-</div>
                    </div>
                    </div>
                    
                    <div class="models-section">
                        <div class="section-header">
                            <h2 class="section-title">Uploaded Furniture</h2>
                            <button class="refresh-button" onclick="loadModels()">Refresh</button>
                        </div>
                        
                        <div id="modelsContainer">
                            <div class="loading">Loading furniture...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Images Page -->
            <div class="page" id="imagesPage" style="display: none;">
                <div class="header">
                    <div class="header-content">
                        <h1>🖼️ Images Library</h1>
                        <p class="header-subtitle">Manage logos and brand assets</p>
                    </div>
                    <div class="header-actions">
                        <button onclick="showImageUploadModal()" class="action-button primary">
                            ⬆️ Upload Image
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="filters-section">
                        <div class="filter-group">
                            <label class="filter-label">Filter by Type:</label>
                            <select id="imageTypeFilter" class="filter-select" onchange="filterImages()">
                                <option value="all">All Types</option>
                                <option value="logo">Company Logo</option>
                                <option value="customer_logo">Customer Logo</option>
                                <option value="brand">Brand Asset</option>
                                <option value="general">General</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Filter by Customer:</label>
                            <select id="imageCustomerFilter" class="filter-select" onchange="filterImages()">
                                <option value="all">All Customers</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <input type="text" id="imageSearchFilter" class="filter-input" placeholder="Search images..." oninput="filterImages()">
                        </div>
                    </div>
                    
                    <div class="images-grid" id="imagesGrid">
                        <div class="loading">Loading images...</div>
                    </div>
                </div>
            </div>
            
            <!-- Users Page -->
            <div class="page" id="usersPage" style="display: none;">
                <div class="header">
                    <div class="header-content">
                        <h1>👥 User Management</h1>
                        <p class="header-subtitle">Manage admin and customer accounts</p>
                    </div>
                    <div class="header-actions">
                        <button onclick="toggleUserModal()" class="action-button primary">
                            ➕ Add User
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="users-section">
                        <div id="usersContainer">
                            <div class="loading">Loading users...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <div class="password-modal" id="uploadModal">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L15.09 8.26L22 9L17 14.74L18.18 21.02L12 18L5.82 21.02L7 14.74L2 9L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title">Upload New Furniture</h3>
                <p class="upload-subtitle">Transform your 3D furniture into AR experiences</p>
            </div>
            
            <form id="uploadForm">
                <div class="futuristic-drop-zone" id="dropZone">
                    <input type="file" id="fileInput" accept=".glb,.gltf" style="display: none;">
                    <div class="drop-zone-content">
                        <div class="drop-animation">
                            <div class="drop-ring"></div>
                            <div class="drop-ring"></div>
                            <div class="drop-ring"></div>
                        </div>
                        <div class="upload-text">
                            <span class="primary-text">Drag & drop your 3D furniture</span>
                            <span class="secondary-text">or <span class="click-text">click to browse</span></span>
                        </div>
                        <div class="format-info">
                            <span class="format-badge">GLB</span>
                            <span class="format-badge">GLTF</span>
                            <span class="size-limit">Max 100MB</span>
                        </div>
                    </div>
                    <div class="drag-overlay">
                        <div class="drag-content">
                            <div class="drag-icon">⚡</div>
                            <span>Drop to upload</span>
                        </div>
                    </div>
                </div>
                
                <div class="file-preview-container" id="filePreviewContainer" style="display: none;">
                    <div class="file-preview-card">
                        <div class="file-icon">📦</div>
                        <div class="file-info">
                            <div class="file-name" id="previewFileName"></div>
                            <div class="file-size" id="previewFileSize"></div>
                        </div>
                        <button type="button" class="remove-file-btn" onclick="removeFile()">✕</button>
                    </div>
                </div>
                
                <div class="input-group">
                    <select id="customerSelect" class="futuristic-input customer-select">
                        <option value="napo:NAPO">NAPO</option>
                        <option value="unassigned:Unassigned">Unassigned</option>
                    </select>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <input type="text" id="titleInput" placeholder="Furniture Title" class="futuristic-input">
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <textarea id="descriptionInput" placeholder="Description (optional)" rows="3" class="futuristic-input textarea"></textarea>
                    <div class="input-line"></div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeUploadModal()">Cancel</button>
                    <button type="submit" class="modal-button primary futuristic-primary" id="uploadButton">
                        <span class="button-text">Upload Furniture</span>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </form>
            
            <div id="uploadProgress" class="upload-progress" style="display: none;">
                <div class="progress-label" id="uploadStatus">Uploading...</div>
                <div class="progress-container">
                    <div class="progress-track">
                        <div id="progressBar" class="progress-fill"></div>
                        <div class="progress-glow"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div class="password-modal" id="userEditModal" style="display: none;">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title" id="editModalTitle">⚙️ Manage User</h3>
                <p class="upload-subtitle" id="editModalSubtitle">Edit user settings and permissions</p>
            </div>
            
            <div class="user-edit-sections">
                <!-- Password Reset Section -->
                <div class="edit-section">
                    <h4 class="section-title">🔑 Password Reset</h4>
                    <div class="input-group">
                        <input type="password" id="editNewPassword" placeholder="New Password" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    <button type="button" class="modal-button secondary" onclick="resetUserPassword()" style="width: 100%; margin-top: 10px;">
                        Generate Random Password
                    </button>
                </div>
                
                <!-- Customer Info Section (only for customer role) -->
                <div class="edit-section" id="customerInfoSection" style="display: none;">
                    <h4 class="section-title">👤 Customer Information</h4>
                    <div class="input-group">
                        <input type="text" id="editCustomerId" placeholder="Customer ID (e.g., napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    <div class="input-group">
                        <input type="text" id="editCustomerName" placeholder="Customer Display Name" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    
                    <!-- Customer Logo Section -->
                    <div class="customer-logo-section">
                        <h5 class="subsection-title">🎨 Customer Logo</h5>
                        <div class="logo-management">
                            <div class="current-logo" id="currentCustomerLogo">
                                <div class="logo-placeholder">No logo uploaded</div>
                            </div>
                            <div class="logo-actions">
                                <button type="button" class="action-button secondary" onclick="showCustomerLogoUpload()">
                                    📤 Upload Logo
                                </button>
                                <button type="button" class="action-button danger" id="removeLogoBtn" onclick="removeCustomerLogo()" style="display: none;">
                                    🗑️ Remove
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Status Section -->
                <div class="edit-section">
                    <h4 class="section-title">🔄 Account Status</h4>
                    <button type="button" id="toggleStatusBtn" class="modal-button danger" onclick="toggleUserStatus()" style="width: 100%;">
                        Deactivate Account
                    </button>
                    <p id="protectedUserNote" style="display: none; color: #7d8590; font-size: 0.8rem; text-align: center; margin-top: 10px;">
                        Admin users are protected and cannot be deactivated.
                    </p>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="modal-button secondary" onclick="closeUserEditModal()">Cancel</button>
                <button type="button" class="modal-button primary futuristic-primary" onclick="saveUserChanges()">
                    <span class="button-text">Save Changes</span>
                    <div class="button-glow"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="password-modal" id="userModal" style="display: none;">
        <div class="modal-content futuristic-upload">
            <div class="upload-header">
                <div class="upload-icon-container">
                    <div class="upload-icon-bg">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M12.5 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8ZM16 11l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <h3 class="upload-title">Create New User</h3>
                <p class="upload-subtitle">Add customer or admin accounts</p>
            </div>
            
            <form id="userForm">
                <div class="input-group">
                    <input type="text" id="newUsername" placeholder="Username" class="futuristic-input" required>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <input type="password" id="newPassword" placeholder="Password" class="futuristic-input" required>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-group">
                    <select id="newRole" class="futuristic-input" required>
                        <option value="">Select Role</option>
                        <option value="customer">Customer</option>
                        <option value="admin">Administrator</option>
                    </select>
                    <div class="input-line"></div>
                </div>
                
                <div id="customerFields" style="display: none;">
                    <div class="input-group">
                        <input type="text" id="newCustomerId" placeholder="Customer ID (e.g., napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                    
                    <div class="input-group">
                        <input type="text" id="newCustomerName" placeholder="Customer Display Name (e.g., Napo)" class="futuristic-input">
                        <div class="input-line"></div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeUserModal()">Cancel</button>
                    <button type="submit" class="modal-button primary futuristic-primary" id="createUserButton">
                        <span class="button-text">Create User</span>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Variant Modal -->
    <div class="password-modal" id="variantModal" style="display: none;">
        <div class="modal-content futuristic-upload" style="max-width: 500px;">
            <h3 class="upload-title" id="variantModalTitle" style="margin-bottom: 20px;">Add Variant</h3>
            
            <form id="variantForm">
                <!-- Title Input -->
                <div class="input-group" style="margin-bottom: 25px;">
                    <input type="text" id="variantName" placeholder="Variant title" required class="futuristic-input" style="font-size: 1rem;">
                    <div class="input-line"></div>
                </div>
                
                <!-- Upload Area -->
                <div class="modern-file-upload" onclick="document.getElementById('variantFile').click()" id="fileUploadArea" style="margin-bottom: 25px;">
                    <div class="upload-content">
                        <div class="upload-icon-modern">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </div>
                        <div class="upload-text-modern">
                            <span class="upload-primary">Drop GLB file or click to browse</span>
                            <span class="upload-secondary">Max 100MB</span>
                        </div>
                    </div>
                    <div class="upload-border"></div>
                </div>
                
                <input type="file" id="variantFile" accept=".glb,.gltf" style="display: none;" onchange="updateVariantFileName()" required>
                <div id="variantFileName" class="file-name-modern" style="display: none;"></div>
                
                <input type="hidden" name="variantType" value="upload">
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeVariantModal()">Cancel</button>
                    <button type="submit" class="modal-button primary futuristic-primary" id="variantUploadButton">
                        <span class="button-text">Upload</span>
                        <div class="button-glow"></div>
                    </button>
                </div>
            </form>
            
            <div id="variantUploadProgress" class="upload-progress" style="display: none;">
                <div class="progress-label" id="variantUploadStatus">Creating variant...</div>
                <div class="progress-container">
                    <div class="progress-track">
                        <div class="progress-fill" id="variantProgressBar" style="width: 0%;">
                            <div class="progress-glow"></div>
                        </div>
                    </div>
                    <div class="progress-percentage" id="variantProgressPercentage">0%</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Image Upload Modal -->
    <div class="password-modal" id="imageUploadModal" style="display: none;">
        <div class="modal-content futuristic-upload" style="max-width: 500px;">
            <h3 class="upload-title">Upload Image</h3>
            <p class="upload-subtitle">Upload logos and brand assets</p>
            
            <form id="imageUploadForm">
                <!-- Image Type Selection -->
                <div class="input-group" style="margin-bottom: 20px;">
                    <select id="imageType" class="futuristic-input" style="width: 100%; background: rgba(13, 17, 23, 0.8); color: #f0f6fc;">
                        <option value="logo">Company Logo</option>
                        <option value="customer_logo">Customer Logo</option>
                        <option value="brand">Brand Asset</option>
                        <option value="general">General Image</option>
                    </select>
                    <div class="input-line"></div>
                </div>
                
                <!-- Upload Area -->
                <div class="modern-file-upload" onclick="document.getElementById('imageFile').click()" id="imageFileUploadArea" style="margin-bottom: 25px;">
                    <div class="upload-content">
                        <div class="upload-icon-modern">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                        </div>
                        <div class="upload-text-modern">
                            <span class="upload-primary">Drop image or click to browse</span>
                            <span class="upload-secondary">JPG, PNG, WebP, SVG (Max 10MB)</span>
                        </div>
                    </div>
                    <div class="upload-border"></div>
                </div>
                
                <input type="file" id="imageFile" accept=".jpg,.jpeg,.png,.webp,.svg" style="display: none;" onchange="updateImageFileName()">
                <div id="imageFileName" class="file-name-modern" style="display: none;"></div>
                
                <div class="modal-buttons">
                    <button type="button" class="modal-button secondary" onclick="closeImageUploadModal()">Close</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        let deleteTarget = null;
        
        // Load models on page load
        loadModels();
        
        // Initialize customers after customerManager is defined
        // This will be called after the CustomerDataManager class is instantiated
        
        async function loadModels() {
            try {
                const response = await fetch('/api/models');
                if (!response.ok) throw new Error('Failed to load models');
                
                const data = await response.json();
                
                // Update main stats
                document.getElementById('totalModels').textContent = data.stats.totalModels || 0;
                document.getElementById('totalViews').textContent = data.stats.totalViews || 0;
                document.getElementById('totalSize').textContent = formatFileSize(data.stats.totalSize || 0);
                
                // Update sidebar stats
                document.getElementById('sidebarTotalModels').textContent = data.stats.totalModels || 0;
                document.getElementById('sidebarTotalViews').textContent = data.stats.totalViews || 0;
                
                // Group models by customer
                displayGroupedModels(data.models);
                
            } catch (error) {
                console.error('Error loading furniture:', error);
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>Error Loading Furniture</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize customers using centralized manager
        async function initializeCustomers() {
            await customerManager.loadFromAPI();
        }
        
        // Legacy function for backward compatibility
        async function loadCustomers() {
            await customerManager.loadFromAPI();
        }
        
        // Update sidebar customer count for specific customer
        function updateSidebarCustomerCount(customerId, count) {
            const customerItems = document.querySelectorAll('.customer-item');
            customerItems.forEach(item => {
                const customerName = item.querySelector('.customer-name').textContent.trim();
                const customer = customerManager.getAllCustomers().find(c => c.name === customerName);
                
                if (customer && customer.id === customerId) {
                    const countBadge = item.querySelector('.customer-count');
                    if (countBadge) {
                        countBadge.textContent = count;
                    }
                }
            });
        }
        
        // Refresh all assign dropdowns with latest customer data
        function refreshAssignDropdowns() {
            // This will be called when assign dropdowns are opened
            // No need to update all at once for performance
        }
        
        function updateCustomerSelect(customers) {
            const select = document.getElementById('customerSelect');
            select.innerHTML = '';
            
            // Add default customers
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = `${customer.id}:${customer.name}`;
                option.textContent = customer.name;
                select.appendChild(option);
            });
            
            // Ensure NAPO is always available
            if (!customers.find(c => c.id === 'napo')) {
                const napoOption = document.createElement('option');
                napoOption.value = 'napo:NAPO';
                napoOption.textContent = 'NAPO';
                select.insertBefore(napoOption, select.firstChild);
            }
        }
        
        function displayGroupedModels(models) {
            if (!models || models.length === 0) {
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>No Furniture Yet</h3>
                        <p>Upload your first furniture piece to get started!</p>
                        <br>
                        <button class="action-button" onclick="toggleUploadModal()">📤 Upload Furniture</button>
                    </div>
                `;
                return;
            }
            
            // Group models by customer
            const customerGroups = {};
            models.forEach(model => {
                const customerKey = model.customer_id || 'unassigned';
                const customerName = model.customer_name || 'Unassigned';
                
                if (!customerGroups[customerKey]) {
                    customerGroups[customerKey] = {
                        id: customerKey,
                        name: customerName,
                        models: [],
                        totalViews: 0,
                        totalSize: 0
                    };
                }
                
                customerGroups[customerKey].models.push(model);
                customerGroups[customerKey].totalViews += model.view_count || 0;
                customerGroups[customerKey].totalSize += model.file_size || 0;
            });
            
            let html = '<div class="customer-groups">';
            
            // Sort customers (NAPO first, then others)
            const sortedCustomers = Object.values(customerGroups).sort((a, b) => {
                if (a.id === 'napo') return -1;
                if (b.id === 'napo') return 1;
                return a.name.localeCompare(b.name);
            });
            
            sortedCustomers.forEach(customer => {
                html += `
                    <div class="customer-group" data-customer="${customer.id}">
                        <div class="customer-header" onclick="toggleCustomerGroup('${customer.id}')">
                            <div class="customer-name">
                                ${customer.name}
                                <span class="customer-badge">${customer.models.length}</span>
                            </div>
                            <div class="customer-stats">
                                ${customer.totalViews} views • ${formatFileSize(customer.totalSize)}
                                <span class="expand-icon">▼</span>
                            </div>
                        </div>
                        <div class="customer-content">
                            <div class="models-grid">
                                ${customer.models.map(model => generateModelCard(model)).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('modelsContainer').innerHTML = html;
        }
        
        function generateModelCard(model) {
            const viewUrl = `https://newfurniture.live/view?id=${model.id}`;
            const modelUrl = model.cloudinary_url || `/api/model/${model.id}`;
            
            return `
                <div class="model-card">
                    <div class="model-preview">
                        <model-viewer
                            class="model-viewer"
                            src="${modelUrl}"
                            alt="${model.title || 'Furniture Piece'}"
                            camera-controls
                            auto-rotate
                            auto-rotate-delay="2000"
                            rotation-per-second="15deg"
                            shadow-intensity="1"
                            camera-orbit="45deg 55deg auto"
                            loading="eager"
                            poster=""
                            environment-image="neutral"
                            exposure="1">
                            <div slot="progress-bar" style="display: none;"></div>
                        </model-viewer>
                    </div>
                    
                    <div class="model-info">
                        <div class="model-title editable-title" data-model-id="${model.id}" ondblclick="startEditTitle(this)">${model.title || 'Untitled'}</div>
                        <div class="model-description">${model.description || 'No description provided'}</div>
                        
                        <div class="model-meta">
                            <span class="model-id" style="display: none;">${model.id}</span>
                            <span>${formatDate(model.upload_date)}</span>
                        </div>
                        
                        <div class="model-stats">
                            <div class="stat-item">
                                <div class="stat-value">${model.view_count || 0}</div>
                                <div class="stat-label">Views</div>
                            </div>
                        </div>
                        
                        ${model.variants && model.variants.length > 0 ? `
                        <div class="model-variants">
                            <div class="variants-label">Available Colors:</div>
                            <div class="variants-circles">
                                <!-- Always show original as first variant with extracted color -->
                                <div class="variant-circle original-variant" 
                                     style="background: ${model.dominant_color || '#6b7280'};" 
                                     title="Original"
                                     data-model-id="${model.id}"
                                     onclick="switchToVariant('${model.id}', 'original', '${modelUrl}')">
                                </div>
                                ${model.variants.map(variant => `
                                    <div class="variant-wrapper">
                                        <div class="variant-circle ${variant.is_primary ? 'primary' : ''}" 
                                             style="background-color: ${variant.hex_color};" 
                                             title="${variant.variant_name}"
                                             onclick="switchToVariant('${model.id}', '${variant.id}', '${variant.cloudinary_url}', '${variant.hex_color}', '${variant.variant_type || 'upload'}')">
                                             ${variant.is_primary ? '★' : ''}
                                        </div>
                                        <div class="variant-delete" 
                                             title="Delete ${variant.variant_name}"
                                             onclick="deleteVariant('${variant.id}', '${model.id}', event)">×</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="model-actions">
                            <a href="/view?id=${model.id}" target="_blank" class="action-button">
                                👁️ View AR
                            </a>
                            <button class="action-button" onclick="copyToClipboard('${viewUrl}', this)">
                                📋 Copy Link
                            </button>
                            <div class="assign-dropdown">
                                <button class="action-button assign-button" onclick="toggleAssignDropdown(this, '${model.id}', '${model.customer_id}', '${model.customer_name}')">
                                    🏷️ Assign
                                </button>
                                <div class="assign-dropdown-content">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                            <button class="action-button variant-btn" onclick="openVariantModal('${model.id}', '${model.title}')">
                                🎨 Add Variant
                            </button>
                            <button class="action-button delete" onclick="deleteModel('${model.id}', '${model.cloudinary_public_id}')">
                                🗑️ Remove
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function toggleCustomerGroup(customerId) {
            const group = document.querySelector(`[data-customer="${customerId}"]`);
            group.classList.toggle('collapsed');
        }
        
        function deleteModel(id, cloudinaryPublicId) {
            deleteTarget = { id, cloudinaryPublicId };
            
            if (confirm('Are you sure you want to delete this model?')) {
                // Find the delete button and show loading state
                const deleteButton = document.querySelector(`button[onclick*="${id}"]`);
                if (deleteButton) {
                    deleteButton.disabled = true;
                    deleteButton.innerHTML = '<span class="loading-spinner"></span> Removing...';
                    deleteButton.style.opacity = '0.7';
                }
                confirmDelete();
            }
        }
        
        async function confirmDelete() {
            try {
                const response = await fetch('/api/models', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(deleteTarget)
                });
                
                if (!response.ok) throw new Error('Failed to delete model');
                
                // Reload models
                loadModels();
                
            } catch (error) {
                alert('Error deleting model: ' + error.message);
                
                // Reset button state on error
                if (deleteTarget) {
                    const deleteButton = document.querySelector(`button[onclick*="${deleteTarget.id}"]`);
                    if (deleteButton) {
                        deleteButton.disabled = false;
                        deleteButton.innerHTML = '🗑️ Remove';
                        deleteButton.style.opacity = '1';
                    }
                }
            }
        }
        
        
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }
        
        function formatFileSize(bytes) {
            if (!bytes) return '0 MB';
            const mb = bytes / (1024 * 1024);
            if (mb < 1) {
                const kb = bytes / 1024;
                return kb.toFixed(1) + ' KB';
            }
            return mb.toFixed(1) + ' MB';
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        let selectedFile = null;

        // Upload modal functions
        function toggleUploadModal() {
            document.getElementById('uploadModal').style.display = 'flex';
            setupDragAndDrop();
        }
        
        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
            document.getElementById('uploadForm').reset();
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressPercentage').textContent = '0%';
            selectedFile = null;
            hideFilePreview();
        }
        
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            
            dropZone.onclick = () => fileInput.click();
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, handleDragEnter, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, handleDragLeave, false);
            });

            dropZone.addEventListener('drop', handleFileDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);
        }
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function handleDragEnter(e) {
            document.getElementById('dropZone').classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            document.getElementById('dropZone').classList.remove('drag-over');
        }
        
        function handleFileDrop(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }
        
        function handleFile(file) {
            if (!file.name.match(/\.(glb|gltf)$/i)) {
                alert('Please select a GLB or GLTF file');
                return;
            }
            
            if (file.size > 100 * 1024 * 1024) {
                alert('File size must be less than 100MB');
                return;
            }
            
            selectedFile = file;
            showFilePreview(file);
            
            // Auto-fill title
            if (!document.getElementById('titleInput').value) {
                document.getElementById('titleInput').value = file.name.replace(/\.(glb|gltf)$/i, '');
            }
        }
        
        function showFilePreview(file) {
            document.getElementById('previewFileName').textContent = file.name;
            document.getElementById('previewFileSize').textContent = formatFileSize(file.size);
            document.getElementById('filePreviewContainer').style.display = 'block';
            document.getElementById('dropZone').style.display = 'none';
        }
        
        function hideFilePreview() {
            document.getElementById('filePreviewContainer').style.display = 'none';
            document.getElementById('dropZone').style.display = 'block';
        }
        
        function removeFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            hideFilePreview();
        }
        
        function formatFileSize(bytes) {
            const mb = bytes / (1024 * 1024);
            if (mb < 1) {
                return (bytes / 1024).toFixed(1) + ' KB';
            }
            return mb.toFixed(1) + ' MB';
        }
        
        // Handle upload form
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!selectedFile) {
                alert('Please select a furniture file');
                return;
            }
            
            const titleInput = document.getElementById('titleInput');
            const descriptionInput = document.getElementById('descriptionInput');
            const customerSelect = document.getElementById('customerSelect');
            
            // Parse customer selection
            const [customerId, customerName] = customerSelect.value.split(':');
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('title', titleInput.value || selectedFile.name.replace(/\.(glb|gltf)$/i, ''));
            formData.append('description', descriptionInput.value || '');
            formData.append('customerId', customerId);
            formData.append('customerName', customerName);
            
            // Show progress
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('uploadButton').disabled = true;
            document.getElementById('uploadStatus').textContent = 'Preparing upload...';
            
            try {
                // Enhanced progress simulation with different stages
                let progress = 0;
                let stage = 0;
                const stages = ['Preparing upload...', 'Uploading furniture...', 'Processing file...', 'Finalizing...'];
                
                const progressInterval = setInterval(() => {
                    progress += 5;
                    if (progress <= 90) {
                        document.getElementById('progressBar').style.width = progress + '%';
                        document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
                        
                        // Update stage text
                        const newStage = Math.floor(progress / 25);
                        if (newStage !== stage && stages[newStage]) {
                            stage = newStage;
                            document.getElementById('uploadStatus').textContent = stages[stage];
                        }
                    }
                }, 150);
                
                const response = await fetch('/api/upload-simple', {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercentage').textContent = '100%';
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Upload failed');
                }
                
                const result = await response.json();
                document.getElementById('uploadStatus').textContent = '✅ Upload successful!';
                
                // Extract and save dominant color after successful upload
                if (result.success && result.id) {
                    setTimeout(async () => {
                        await extractAndSaveModelColor(result.id);
                    }, 3000); // Wait for model to be processed
                }
                
                // Close modal and refresh models after 2 seconds
                setTimeout(() => {
                    closeUploadModal();
                    loadModels();
                }, 2000);
                
            } catch (error) {
                document.getElementById('uploadStatus').textContent = '❌ Upload failed: ' + error.message;
                document.getElementById('uploadButton').disabled = false;
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('progressPercentage').textContent = '0%';
            }
        });
        
        // Auto-refresh every 30 seconds
        setInterval(loadModels, 30000);
        
        // Centralized Customer Data Management
        class CustomerDataManager {
            constructor() {
                this.customers = new Map();
                this.listeners = new Set();
            }
            
            // Add or update customer
            setCustomer(customer) {
                const existed = this.customers.has(customer.id);
                this.customers.set(customer.id, customer);
                
                if (existed) {
                    this.notifyListeners('customerUpdated', customer);
                } else {
                    this.notifyListeners('customerAdded', customer);
                }
            }
            
            // Get customer by ID
            getCustomer(customerId) {
                return this.customers.get(customerId);
            }
            
            // Get all customers as array
            getAllCustomers() {
                return Array.from(this.customers.values()).sort((a, b) => a.name.localeCompare(b.name));
            }
            
            // Update customer count
            updateCustomerCount(customerId, count) {
                const customer = this.customers.get(customerId);
                if (customer) {
                    customer.count = count;
                    this.notifyListeners('customerCountUpdated', customer);
                }
            }
            
            // Check if customer exists
            hasCustomer(customerId) {
                return this.customers.has(customerId);
            }
            
            // Add event listener
            addListener(callback) {
                this.listeners.add(callback);
            }
            
            // Remove event listener
            removeListener(callback) {
                this.listeners.delete(callback);
            }
            
            // Notify all listeners of changes
            notifyListeners(event, data) {
                this.listeners.forEach(listener => {
                    try {
                        listener(event, data);
                    } catch (error) {
                        console.error('Customer data listener error:', error);
                    }
                });
            }
            
            // Load customers from API
            async loadFromAPI() {
                try {
                    const response = await fetch('/api/customers');
                    if (!response.ok) throw new Error('Failed to load customers');
                    
                    const data = await response.json();
                    data.customers.forEach(customer => {
                        this.customers.set(customer.id, customer);
                    });
                    
                    this.notifyListeners('customersLoaded', this.getAllCustomers());
                } catch (error) {
                    console.error('Error loading customers:', error);
                }
            }
        }
        
        // Global customer manager instance
        const customerManager = new CustomerDataManager();
        
        // Initialize customer data manager listeners and start initialization
        customerManager.addListener((event, data) => {
            switch(event) {
                case 'customersLoaded':
                case 'customerAdded':
                case 'customerUpdated':
                    // Update sidebar customer list
                    updateSidebarCustomers(customerManager.getAllCustomers());
                    // Update assign dropdowns
                    refreshAssignDropdowns();
                    // Update upload modal dropdown
                    updateCustomerSelect(customerManager.getAllCustomers());
                    break;
                    
                case 'customerCountUpdated':
                    // Update sidebar counts
                    updateSidebarCustomerCount(data.id, data.count);
                    break;
            }
        });
        
        // Now initialize customers (after customerManager is ready)
        initializeCustomers();
        
        // Sidebar functionality
        let currentCustomerFilter = null;
        let searchQuery = '';
        let allCustomers = []; // Keep for backward compatibility
        
        
        function updateSidebarCustomers(customers) {
            allCustomers = customers;
            const customerList = document.getElementById('customerList');
            customerList.innerHTML = '';
            
            // Add "All Furniture" option
            const allItem = document.createElement('li');
            allItem.className = `customer-item ${currentCustomerFilter === null ? 'active' : ''}`;
            allItem.setAttribute('data-customer-id', 'all');
            allItem.innerHTML = `
                <div class="customer-item-content">
                    <span class="customer-name">All Furniture</span>
                    <span class="customer-count">${customers.reduce((sum, c) => sum + c.count, 0)}</span>
                </div>
            `;
            allItem.onclick = () => filterByCustomer(null);
            customerList.appendChild(allItem);
            
            // Add "Unassigned" option - only show if there are unassigned items
            const unassignedCustomer = customers.find(c => c.id === 'unassigned');
            const unassignedCount = unassignedCustomer?.count || 0;
            
            // Only show Unassigned section if there are unassigned items
            if (unassignedCount > 0) {
                const unassignedItem = document.createElement('li');
                unassignedItem.className = `customer-item ${currentCustomerFilter === 'unassigned' ? 'active' : ''}`;
                unassignedItem.setAttribute('data-customer-id', 'unassigned');
                unassignedItem.innerHTML = `
                    <div class="customer-item-content">
                        <span class="customer-name">Unassigned</span>
                        <span class="customer-count">${unassignedCount}</span>
                    </div>
                `;
                unassignedItem.onclick = () => filterByCustomer('unassigned', 'Unassigned');
                customerList.appendChild(unassignedItem);
            } else if (currentCustomerFilter === 'unassigned') {
                // If currently filtering by unassigned but no unassigned items exist, reset to "All"
                filterByCustomer(null);
            }
            
            console.log('Debug: Customers from API:', customers);
            console.log('Debug: Unassigned customer found:', unassignedCustomer);
            console.log('Debug: Unassigned count:', unassignedCount);
            
            // Add customer items (excluding unassigned which we show separately)
            customers.filter(customer => customer.id !== 'unassigned').forEach(customer => {
                const item = document.createElement('li');
                item.className = `customer-item ${currentCustomerFilter === customer.id ? 'active' : ''}`;
                item.setAttribute('data-customer-id', customer.id);
                item.innerHTML = `
                    <div class="customer-item-content">
                        <span class="customer-name">${customer.name}</span>
                        <span class="customer-count">${customer.count}</span>
                    </div>
                `;
                item.onclick = () => filterByCustomer(customer.id, customer.name);
                customerList.appendChild(item);
            });
            
            // Update sidebar stats (excluding unassigned from customer count)
            const actualCustomerCount = customers.filter(c => c.id !== 'unassigned').length;
            document.getElementById('sidebarTotalCustomers').textContent = actualCustomerCount;
        }
        
        function filterByCustomer(customerId, customerName = null) {
            // Always navigate to Dashboard first (if not already there)
            if (currentPage !== 'dashboard') {
                console.log(`🔄 Switching from ${currentPage} to Dashboard to show customer: ${customerName || customerId}`);
                navigateToPage('dashboard');
            }
            
            currentCustomerFilter = customerId;
            
            // Update active state in sidebar
            document.querySelectorAll('.customer-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and highlight the clicked customer
            const customerIdToFind = customerId === null ? 'all' : customerId;
            const clickedCustomer = document.querySelector(`.customer-item[data-customer-id="${customerIdToFind}"]`);
            if (clickedCustomer) {
                clickedCustomer.classList.add('active');
            } else if (event && event.target) {
                // Fallback to event target if available
                const customerItem = event.target.closest('.customer-item');
                if (customerItem) {
                    customerItem.classList.add('active');
                }
            }
            
            // Filter displayed models
            const customerGroups = document.querySelectorAll('.customer-group');
            customerGroups.forEach(group => {
                const groupCustomerId = group.getAttribute('data-customer');
                if (currentCustomerFilter === null) {
                    // Show all
                    group.style.display = 'block';
                } else {
                    // Show only matching customer
                    group.style.display = groupCustomerId === currentCustomerFilter ? 'block' : 'none';
                }
            });
            
            // Update header to show current filter
            const headerTitle = document.querySelector('#dashboardPage .header h1');
            if (customerId === null) {
                headerTitle.textContent = '⚙️ Admin Dashboard';
            } else {
                headerTitle.textContent = `⚙️ ${customerName || 'Customer'} Dashboard`;
            }
        }
        
        function handleSearch(query) {
            searchQuery = query.toLowerCase();
            
            // If no query, show current filter
            if (!searchQuery) {
                filterByCustomer(currentCustomerFilter);
                return;
            }
            
            // Search through all cards
            const modelCards = document.querySelectorAll('.model-card');
            const customerGroups = document.querySelectorAll('.customer-group');
            
            // First hide all groups
            customerGroups.forEach(group => {
                group.style.display = 'none';
            });
            
            // Show cards that match search
            let hasResults = false;
            modelCards.forEach(card => {
                const title = card.querySelector('.model-title')?.textContent?.toLowerCase() || '';
                const description = card.querySelector('.model-description')?.textContent?.toLowerCase() || '';
                const customerName = card.closest('.customer-group')?.querySelector('.customer-name')?.textContent?.toLowerCase() || '';
                
                const matches = title.includes(searchQuery) || 
                               description.includes(searchQuery) || 
                               customerName.includes(searchQuery);
                
                if (matches) {
                    hasResults = true;
                    // Show the parent group
                    const group = card.closest('.customer-group');
                    if (group) {
                        group.style.display = 'block';
                    }
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            if (!hasResults) {
                // Show empty state in main area
                document.getElementById('modelsContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>No Results Found</h3>
                        <p>No furniture matches "${query}"</p>
                    </div>
                `;
            }
        }
        
        // Open user modal with customer role pre-selected
        function openUserModalForCustomer() {
            toggleUserModal();
            // Pre-select customer role
            document.getElementById('newRole').value = 'customer';
            // Trigger change event to show customer fields
            document.getElementById('newRole').dispatchEvent(new Event('change'));
            // Focus on username field
            setTimeout(() => {
                document.getElementById('newUsername').focus();
            }, 100);
        }

        function showAddCustomerForm() {
            document.getElementById('addCustomerForm').style.display = 'block';
            document.getElementById('addCustomerNameInput').focus();
        }
        
        function hideAddCustomerForm() {
            document.getElementById('addCustomerForm').style.display = 'none';
            document.getElementById('addCustomerNameInput').value = '';
        }
        
        function handleCustomerNameKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                saveNewCustomer();
            } else if (event.key === 'Escape') {
                event.preventDefault();
                hideAddCustomerForm();
            }
        }
        
        async function saveNewCustomer() {
            const customerName = document.getElementById('addCustomerNameInput').value.trim();
            if (!customerName) return;
            
            try {
                hideAddCustomerForm();
                
                // Create customer ID from name (simple slug)
                const customerId = customerName.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
                
                // Check if already exists in centralized manager
                if (customerManager.hasCustomer(customerId)) {
                    alert('Customer already exists!');
                    return;
                }
                
                // Add to centralized customer manager
                customerManager.setCustomer({
                    id: customerId,
                    name: customerName,
                    count: 0
                });
                
            } catch (error) {
                alert('Failed to add customer: ' + error.message);
            }
        }
        
        // Update the existing loadCustomers function to also update sidebar
        const originalLoadCustomers = loadCustomers;
        loadCustomers = async function() {
            await originalLoadCustomers();
            
            // Also fetch for sidebar
            try {
                const response = await fetch('/api/customers');
                if (response.ok) {
                    const data = await response.json();
                    updateSidebarCustomers(data.customers);
                }
            } catch (error) {
                console.error('Error loading customers for sidebar:', error);
            }
        };
        
        // Update the existing loadModels function to also update sidebar stats
        const originalLoadModels = loadModels;
        loadModels = async function() {
            await originalLoadModels();
            
            // Update sidebar stats
            try {
                const response = await fetch('/api/models');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('sidebarTotalModels').textContent = data.stats.totalModels || 0;
                    document.getElementById('sidebarTotalViews').textContent = data.stats.totalViews || 0;
                }
            } catch (error) {
                console.error('Error updating sidebar stats:', error);
            }
        };
        
        
        function updateCustomerBadges() {
            document.querySelectorAll('.customer-group').forEach(group => {
                const badge = group.querySelector('.customer-badge');
                const cards = group.querySelectorAll('.model-card');
                if (badge) {
                    badge.textContent = cards.length;
                }
            });
        }
        
        // Assign Dropdown Functions
        function toggleAssignDropdown(button, modelId, currentCustomerId, currentCustomerName) {
            // Close any other open dropdowns
            document.querySelectorAll('.assign-dropdown.show').forEach(dropdown => {
                if (dropdown !== button.parentNode) {
                    dropdown.classList.remove('show');
                }
            });
            
            const dropdown = button.parentNode;
            const content = dropdown.querySelector('.assign-dropdown-content');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                return;
            }
            
            // Populate dropdown with customers
            populateAssignDropdown(content, modelId, currentCustomerId, currentCustomerName);
            dropdown.classList.add('show');
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!dropdown.contains(e.target)) {
                        dropdown.classList.remove('show');
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        }
        
        function populateAssignDropdown(content, modelId, currentCustomerId, currentCustomerName) {
            content.innerHTML = '';
            
            // Show current assignment
            if (currentCustomerId && currentCustomerName) {
                const currentOption = document.createElement('div');
                currentOption.className = 'assign-option current';
                currentOption.innerHTML = `✓ Currently: ${currentCustomerName}`;
                content.appendChild(currentOption);
            }
            
            // Add all customers from centralized manager
            const customers = customerManager.getAllCustomers();
            customers.forEach(customer => {
                if (customer.id !== currentCustomerId) {
                    const option = document.createElement('div');
                    option.className = 'assign-option';
                    option.textContent = customer.name;
                    option.onclick = () => assignFurnitureToCustomer(modelId, customer.id, customer.name);
                    content.appendChild(option);
                }
            });
            
            // Add "Create New Customer" option
            const newOption = document.createElement('div');
            newOption.className = 'assign-option new-customer';
            newOption.innerHTML = '+ Create New Customer';
            newOption.onclick = () => assignToNewCustomer(modelId);
            content.appendChild(newOption);
        }
        
        async function assignFurnitureToCustomer(modelId, customerId, customerName) {
            try {
                // Close dropdown
                document.querySelectorAll('.assign-dropdown.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                
                // No confirmation needed - just assign directly
                
                // Update database via API
                const response = await fetch('/api/assign', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ modelId, customerId, customerName })
                });
                
                if (!response.ok) {
                    const responseText = await response.text();
                    console.error('Assignment API Error Response:', responseText);
                    
                    try {
                        const error = JSON.parse(responseText);
                        throw new Error(error.error || 'Assignment failed');
                    } catch (jsonError) {
                        throw new Error(`API returned non-JSON response: ${responseText.substring(0, 100)}...`);
                    }
                }
                
                const responseText = await response.text();
                console.log('Assignment API Success Response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (jsonError) {
                    console.error('Success response is not valid JSON:', responseText);
                    throw new Error(`API returned non-JSON success response: ${responseText.substring(0, 100)}...`);
                }
                
                // Update UI immediately
                updateModelCardAssignment(modelId, customerId, customerName);
                
                alert(`✅ Furniture assigned to ${customerName}!`);
                
                // Refresh data to ensure consistency
                loadModels();
                loadCustomers();
                
            } catch (error) {
                console.error('Assignment error:', error);
                alert('Failed to assign furniture: ' + error.message);
            }
        }
        
        function updateModelCardAssignment(modelId, customerId, customerName) {
            // Find the model card
            const modelCard = Array.from(document.querySelectorAll('.model-card')).find(card => 
                card.querySelector('.model-id').textContent === modelId
            );
            
            if (!modelCard) return;
            
            // Find or create target customer group
            let targetGroup = document.querySelector(`[data-customer="${customerId}"]`);
            
            if (!targetGroup) {
                // Create new customer group
                const groupsContainer = document.querySelector('.customer-groups');
                targetGroup = document.createElement('div');
                targetGroup.className = 'customer-group';
                targetGroup.setAttribute('data-customer', customerId);
                targetGroup.innerHTML = `
                    <div class="customer-header" onclick="toggleCustomerGroup('${customerId}')">
                        <div class="customer-name">
                            ${customerName}
                            <span class="customer-badge">0</span>
                        </div>
                        <div class="customer-stats">
                            0 views • 0 B
                            <span class="expand-icon">▼</span>
                        </div>
                    </div>
                    <div class="customer-content">
                        <div class="models-grid">
                        </div>
                    </div>
                `;
                
                // Insert in alphabetical order
                const existingGroups = Array.from(groupsContainer.children);
                let inserted = false;
                for (let group of existingGroups) {
                    const groupName = group.querySelector('.customer-name')?.textContent.trim() || '';
                    if (customerName.localeCompare(groupName) < 0) {
                        groupsContainer.insertBefore(targetGroup, group);
                        inserted = true;
                        break;
                    }
                }
                if (!inserted) {
                    groupsContainer.appendChild(targetGroup);
                }
            }
            
            // Move the card
            const targetGrid = targetGroup.querySelector('.models-grid');
            targetGrid.appendChild(modelCard);
            
            // Update assign button to reflect new assignment
            const assignButton = modelCard.querySelector('.assign-button');
            assignButton.setAttribute('onclick', `toggleAssignDropdown(this, '${modelId}', '${customerId}', '${customerName}')`);
            
            // Update customer badges
            updateCustomerBadges();
        }
        
        async function assignToNewCustomer(modelId) {
            const customerName = prompt('Enter new customer name:');
            if (!customerName?.trim()) return;
            
            const customerId = customerName.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
            
            // Check if already exists in centralized manager
            if (customerManager.hasCustomer(customerId)) {
                alert('Customer already exists!');
                return;
            }
            
            // Add to centralized customer manager (this will trigger all UI updates)
            customerManager.setCustomer({
                id: customerId,
                name: customerName,
                count: 0
            });
            
            // Now assign to this customer
            await assignFurnitureToCustomer(modelId, customerId, customerName);
        }

        // User Management Functions - Moved to dedicated page
        
        function toggleUserModal() {
            document.getElementById('userModal').style.display = 'flex';
        }
        
        async function loadUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = '<div class="loading-users" style="padding: 20px; text-align: center; color: #7d8590;">Loading users...</div>';
            
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #f85149;">Failed to load users</div>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #f85149;">Error loading users</div>';
            }
        }
        
        function displayUsers(users) {
            const userList = document.getElementById('userList');
            
            if (users.length === 0) {
                userList.innerHTML = '<div style="padding: 20px; text-align: center; color: #7d8590;">No users found</div>';
                return;
            }
            
            const userHTML = users.map(user => {
                const isAdmin = user.username === 'admin' || user.role === 'admin';
                return `
                    <div class="user-item">
                        <div class="user-item-content">
                            <div class="user-info">
                                <div class="user-name">${user.username}</div>
                                <div class="user-role-container">
                                    <span class="user-role">${user.role}</span>
                                    <button class="user-settings-btn" onclick="openUserEditModal('${user.id}', '${user.username}', '${user.role}', '${user.customer_id || ''}', '${user.customer_name || ''}', ${user.is_active}, ${isAdmin})" title="Manage User">
                                        ⚙️
                                    </button>
                                </div>
                            </div>
                            ${user.total_views ? `<div class="user-views">Views: ${user.total_views}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            userList.innerHTML = userHTML;
        }
        
        // Global variables for user edit modal
        let currentEditUserId = null;
        let currentEditUserData = {};
        
        function openUserEditModal(userId, username, role, customerId, customerName, isActive, isAdmin) {
            currentEditUserId = userId;
            currentEditUserData = {
                username,
                role,
                customerId,
                customerName,
                isActive,
                isAdmin
            };
            
            // Update modal title
            document.getElementById('editModalTitle').textContent = `⚙️ Manage User: ${username}`;
            
            // Show/hide customer info section
            const customerSection = document.getElementById('customerInfoSection');
            if (role === 'customer') {
                customerSection.style.display = 'block';
                document.getElementById('editCustomerId').value = customerId || '';
                document.getElementById('editCustomerName').value = customerName || '';
            } else {
                customerSection.style.display = 'none';
            }
            
            // Update status button
            const statusBtn = document.getElementById('toggleStatusBtn');
            const protectedNote = document.getElementById('protectedUserNote');
            
            if (isAdmin) {
                statusBtn.style.display = 'none';
                protectedNote.style.display = 'block';
            } else {
                statusBtn.style.display = 'block';
                protectedNote.style.display = 'none';
                statusBtn.textContent = isActive ? 'Deactivate Account' : 'Activate Account';
                statusBtn.className = isActive ? 'modal-button danger' : 'modal-button primary';
            }
            
            // Clear password field
            document.getElementById('editNewPassword').value = '';
            
            // Show modal
            document.getElementById('userEditModal').style.display = 'flex';
        }
        
        function closeUserEditModal() {
            document.getElementById('userEditModal').style.display = 'none';
            currentEditUserId = null;
            currentEditUserData = {};
        }
        
        function resetUserPassword() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('editNewPassword').value = password;
        }
        
        async function toggleUserStatus() {
            if (!currentEditUserId) return;
            
            const action = currentEditUserData.isActive ? 'deactivate' : 'activate';
            if (!confirm(`Are you sure you want to ${action} user "${currentEditUserData.username}"?`)) return;
            
            try {
                const response = await fetch(`/api/users/${currentEditUserId}/toggle`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    currentEditUserData.isActive = !currentEditUserData.isActive;
                    const statusBtn = document.getElementById('toggleStatusBtn');
                    statusBtn.textContent = currentEditUserData.isActive ? 'Deactivate Account' : 'Activate Account';
                    statusBtn.className = currentEditUserData.isActive ? 'modal-button danger' : 'modal-button primary';
                    
                    loadUsers(); // Refresh the list
                    alert(`User ${action}d successfully`);
                } else {
                    alert('Failed to update user status');
                }
            } catch (error) {
                console.error('Error updating user status:', error);
                alert('Error updating user status');
            }
        }
        
        async function saveUserChanges() {
            if (!currentEditUserId) return;
            
            const newPassword = document.getElementById('editNewPassword').value.trim();
            const customerId = document.getElementById('editCustomerId').value.trim();
            const customerName = document.getElementById('editCustomerName').value.trim();
            
            try {
                let hasChanges = false;
                
                // Update password if provided
                if (newPassword) {
                    const passwordResponse = await fetch(`/api/users/${currentEditUserId}/password`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password: newPassword })
                    });
                    
                    if (!passwordResponse.ok) {
                        alert('Failed to update password');
                        return;
                    }
                    hasChanges = true;
                }
                
                // Update customer info if role is customer and fields have changed
                if (currentEditUserData.role === 'customer' && 
                    (customerId !== currentEditUserData.customerId || customerName !== currentEditUserData.customerName)) {
                    
                    const customerResponse = await fetch(`/api/users/${currentEditUserId}/customer`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            customerId: customerId || currentEditUserData.customerId,
                            customerName: customerName || currentEditUserData.customerName
                        })
                    });
                    
                    if (!customerResponse.ok) {
                        alert('Failed to update customer information');
                        return;
                    }
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    alert('User updated successfully!');
                    loadUsers(); // Refresh the list
                    closeUserEditModal();
                } else {
                    alert('No changes made');
                    closeUserEditModal();
                }
                
            } catch (error) {
                console.error('Error saving user changes:', error);
                alert('Error saving changes');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                // Clear session and redirect to login
                fetch('/api/logout', { method: 'POST' })
                    .then(() => {
                        window.location.href = '/';
                    })
                    .catch(() => {
                        // Even if logout API fails, redirect anyway
                        window.location.href = '/';
                    });
            }
        }
        
        // Title editing functions (same as customer view)
        let currentEditElement = null;
        
        function startEditTitle(element) {
            if (currentEditElement) {
                cancelEdit();
            }
            
            currentEditElement = element;
            const currentTitle = element.textContent;
            
            element.innerHTML = `
                <input type="text" 
                       class="title-edit-input" 
                       value="${currentTitle}" 
                       onblur="saveTitle(this)"
                       onkeydown="handleTitleKeydown(event, this)"
                       style="
                           background: rgba(22, 27, 34, 0.8);
                           border: 1px solid rgba(88, 166, 255, 0.5);
                           border-radius: 4px;
                           color: #e6edf3;
                           padding: 4px 8px;
                           font-size: inherit;
                           font-weight: inherit;
                           width: 100%;
                           outline: none;
                       ">
            `;
            
            const input = element.querySelector('.title-edit-input');
            input.focus();
            input.select();
        }
        
        function handleTitleKeydown(event, input) {
            if (event.key === 'Enter') {
                saveTitle(input);
            } else if (event.key === 'Escape') {
                cancelEdit();
            }
        }
        
        async function saveTitle(input) {
            if (!currentEditElement) return;
            
            const newTitle = input.value.trim();
            const modelId = currentEditElement.getAttribute('data-model-id');
            
            if (!newTitle) {
                cancelEdit();
                return;
            }
            
            try {
                // Show loading state
                input.disabled = true;
                input.style.opacity = '0.7';
                
                // API call to update title
                const response = await fetch('/api/models', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: modelId,
                        title: newTitle
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to update title');
                }
                
                // Update the display
                currentEditElement.textContent = newTitle;
                console.log(`Updated model ${modelId} title to: ${newTitle}`);
                
                currentEditElement = null;
                
            } catch (error) {
                console.error('Error updating title:', error);
                alert('Failed to save title. Please try again.');
                cancelEdit();
            }
        }
        
        function cancelEdit() {
            if (currentEditElement) {
                const originalTitle = currentEditElement.getAttribute('data-original-title') || currentEditElement.textContent;
                currentEditElement.textContent = originalTitle;
                currentEditElement = null;
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            document.getElementById('userForm').reset();
            document.getElementById('customerFields').style.display = 'none';
        }

        // Show/hide customer fields based on role selection
        document.getElementById('newRole').addEventListener('change', function() {
            const customerFields = document.getElementById('customerFields');
            if (this.value === 'customer') {
                customerFields.style.display = 'block';
                document.getElementById('newCustomerId').required = true;
                document.getElementById('newCustomerName').required = true;
            } else {
                customerFields.style.display = 'none';
                document.getElementById('newCustomerId').required = false;
                document.getElementById('newCustomerName').required = false;
            }
        });

        // Handle user creation form submission
        document.getElementById('userForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const button = document.getElementById('createUserButton');
            const buttonText = button.querySelector('.button-text');
            
            // Get form data
            const formData = new FormData(e.target);
            const userData = {
                username: document.getElementById('newUsername').value,
                password: document.getElementById('newPassword').value,
                role: document.getElementById('newRole').value
            };

            // Add customer fields if role is customer
            if (userData.role === 'customer') {
                userData.customerId = document.getElementById('newCustomerId').value;
                userData.customerName = document.getElementById('newCustomerName').value;
            }

            // Show loading state
            button.disabled = true;
            buttonText.textContent = 'Creating User...';

            try {
                const response = await fetch('/api/create-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`User "${userData.username}" created successfully!\n\nLogin credentials:\nUsername: ${userData.username}\nPassword: ${userData.password}\nRole: ${userData.role}${userData.role === 'customer' ? `\nCustomer: ${userData.customerName}` : ''}`);
                    closeUserModal();
                    
                    // If creating a customer, immediately add to universal customer manager
                    if (userData.role === 'customer' && userData.customerId && userData.customerName) {
                        customerManager.setCustomer({
                            id: userData.customerId,
                            name: userData.customerName,
                            count: 0
                        });
                        console.log('✅ Customer added to universal system:', userData.customerName);
                    }
                    
                    // Refresh all customer-related UI
                    await customerManager.loadFromAPI();
                } else {
                    alert('Failed to create user: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating user:', error);
                alert('Error creating user: ' + error.message);
            } finally {
                // Reset button state
                button.disabled = false;
                buttonText.textContent = 'Create User';
            }
        });

        // Variant Modal Functions
        let currentModelId = null;

        function openVariantModal(modelId, title) {
            currentModelId = modelId;
            document.getElementById('variantModal').style.display = 'flex';
            document.getElementById('variantModalTitle').textContent = 'Add Variant';
        }

        function closeVariantModal() {
            document.getElementById('variantModal').style.display = 'none';
            document.getElementById('variantForm').reset();
            document.getElementById('variantFileName').style.display = 'none';
            // Reset upload area appearance
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.3)';
            uploadArea.style.background = 'rgba(13, 17, 23, 0.5)';
            // Variant type is always upload now
            currentModelId = null;
        }

        // Variant type selection removed - always upload GLB files now

        function updateVariantFileName() {
            const fileInput = document.getElementById('variantFile');
            const fileName = document.getElementById('variantFileName');
            const uploadArea = document.getElementById('fileUploadArea');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName.style.display = 'block';
                
                // Validate file type
                if (!file.name.match(/\.(glb|gltf)$/i)) {
                    fileName.textContent = '❌ Invalid file type (GLB/GLTF only)';
                    fileName.style.background = 'rgba(248, 81, 73, 0.1)';
                    fileName.style.borderColor = 'rgba(248, 81, 73, 0.3)';
                    fileName.style.color = '#f85149';
                } else if (file.size > 100 * 1024 * 1024) {
                    fileName.textContent = '❌ File too large (max 100MB)';
                    fileName.style.background = 'rgba(248, 81, 73, 0.1)';
                    fileName.style.borderColor = 'rgba(248, 81, 73, 0.3)';
                    fileName.style.color = '#f85149';
                } else {
                    fileName.textContent = `✅ ${file.name} (${(file.size / (1024 * 1024)).toFixed(1)} MB)`;
                    fileName.style.background = 'rgba(88, 166, 255, 0.1)';
                    fileName.style.borderColor = 'rgba(88, 166, 255, 0.3)';
                    fileName.style.color = '#58a6ff';
                }
                
                // Update upload area appearance
                uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.6)';
                uploadArea.style.background = 'rgba(88, 166, 255, 0.05)';
            } else {
                fileName.style.display = 'none';
                // Reset upload area
                uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.3)';
                uploadArea.style.background = 'rgba(13, 17, 23, 0.5)';
            }
        }

        // Handle variant creation form submission
        document.getElementById('variantForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentModelId) {
                alert('Error: No model selected');
                return;
            }

            const button = document.getElementById('variantUploadButton');
            const buttonText = button.querySelector('.button-text');
            const fileInput = document.getElementById('variantFile');
            
            // Validate required fields
            const variantName = document.getElementById('variantName').value.trim();
            const hexColor = '#000000'; // Default color since we don't use color picker anymore
            const variantType = 'upload'; // Always upload type now
            
            if (!variantName) {
                alert('Please enter a variant name');
                return;
            }
            
            // Always require file upload now
            if (!fileInput.files.length) {
                alert('Please select a GLB file for the variant');
                return;
            }

            // Show loading state
            button.disabled = true;
            buttonText.textContent = 'Creating Variant...';

            try {
                // Create form data for multipart upload
                const formData = new FormData();
                if (variantType === 'upload' && fileInput.files[0]) {
                    formData.append('file', fileInput.files[0]);
                }
                formData.append('variantName', variantName);
                formData.append('hexColor', hexColor);
                formData.append('variantType', variantType);
                formData.append('isPrimary', document.getElementById('isPrimary').checked);

                const response = await fetch(`/api/variants?modelId=${currentModelId}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`Variant "${variantName}" created successfully!`);
                    closeVariantModal();
                    // Refresh the models display
                    location.reload();
                } else {
                    alert('Failed to create variant: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating variant:', error);
                alert('Error creating variant: ' + error.message);
            } finally {
                // Reset button state
                button.disabled = false;
                buttonText.textContent = 'Create Variant';
            }
        });

        // Convert hex color to RGBA array (0-1 range) for model-viewer
        function hexToRGBA(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            return [r, g, b, 1.0];
        }
        
        // Extract dominant color from rendered GLB using model-viewer screenshot
        async function extractDominantColor(modelViewer) {
            try {
                // Use model-viewer's toDataURL method to get a screenshot
                const dataURL = await modelViewer.toDataURL('image/png', 0.8);
                
                // Create an image and canvas to analyze pixels
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Set canvas size to sample area
                        const sampleSize = 100;
                        canvas.width = sampleSize;
                        canvas.height = sampleSize;
                        
                        // Draw the image scaled down to sample size
                        ctx.drawImage(img, 0, 0, sampleSize, sampleSize);
                        
                        // Get pixel data from center area (avoid background)
                        const centerSize = 60;
                        const centerOffset = (sampleSize - centerSize) / 2;
                        const imageData = ctx.getImageData(centerOffset, centerOffset, centerSize, centerSize);
                        const pixels = imageData.data;
                        
                        // Calculate dominant color
                        const colorCounts = {};
                        const threshold = 15; // Group similar colors
                        
                        for (let i = 0; i < pixels.length; i += 4) {
                            const r = pixels[i];
                            const g = pixels[i + 1];
                            const b = pixels[i + 2];
                            const a = pixels[i + 3];
                            
                            // Skip transparent or very dark/light pixels (likely background)
                            if (a < 200 || (r + g + b) < 60 || (r + g + b) > 700) continue;
                            
                            // Group similar colors to find dominant shade
                            const groupedR = Math.floor(r / threshold) * threshold;
                            const groupedG = Math.floor(g / threshold) * threshold;
                            const groupedB = Math.floor(b / threshold) * threshold;
                            
                            const colorKey = `${groupedR},${groupedG},${groupedB}`;
                            colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
                        }
                        
                        // Find the most common color
                        let dominantColor = '#6b7280';
                        let maxCount = 0;
                        
                        for (const [colorKey, count] of Object.entries(colorCounts)) {
                            if (count > maxCount) {
                                maxCount = count;
                                const [r, g, b] = colorKey.split(',').map(Number);
                                const hexR = Math.max(0, Math.min(255, r)).toString(16).padStart(2, '0');
                                const hexG = Math.max(0, Math.min(255, g)).toString(16).padStart(2, '0');
                                const hexB = Math.max(0, Math.min(255, b)).toString(16).padStart(2, '0');
                                dominantColor = `#${hexR}${hexG}${hexB}`;
                            }
                        }
                        
                        console.log('Extracted dominant color:', dominantColor, 'from', Object.keys(colorCounts).length, 'color groups');
                        resolve(dominantColor);
                    };
                    
                    img.onerror = () => {
                        console.warn('Failed to load model screenshot');
                        resolve('#6b7280');
                    };
                    
                    img.src = dataURL;
                });
                
            } catch (error) {
                console.warn('Failed to extract visual dominant color:', error);
                return '#6b7280'; // Fallback gray
            }
        }
        
        function rgbToHsl(r, g, b) {
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return [h, s, l];
        }
        
        function hslToRgb(h, s, l) {
            let r, g, b;
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [r, g, b];
        }
        
        function intelligentColorRemap(originalRgba, targetRgba) {
            const [or, og, ob] = originalRgba;
            const [tr, tg, tb] = targetRgba;
            
            // Convert to HSL for better color manipulation
            const [oh, os, ol] = rgbToHsl(or, og, ob);
            const [th, ts, tl] = rgbToHsl(tr, tg, tb);
            
            // Preserve original lightness and saturation characteristics
            // but shift the hue towards the target color
            const newH = th; // Use target hue
            const newS = Math.max(os * 0.7, ts * 0.5); // Blend saturation
            const newL = ol * (tl / 0.5); // Adjust lightness proportionally
            
            const [newR, newG, newB] = hslToRgb(newH, Math.min(newS, 1), Math.min(newL, 1));
            return [newR, newG, newB, originalRgba[3]];
        }
        
        function detectMaterialType(material) {
            // Analyze PBR properties to determine material type
            const pbr = material.pbrMetallicRoughness;
            if (!pbr) return 'unknown';
            
            const baseColor = pbr.baseColorFactor || [1, 1, 1, 1];
            const roughness = pbr.roughnessFactor || 1.0;
            const metallic = pbr.metallicFactor || 0.0;
            
            // Calculate material brightness
            const brightness = (baseColor[0] + baseColor[1] + baseColor[2]) / 3;
            
            // Wood detection: Low metallic, medium-high roughness, brownish tones
            const isWoodish = (
                metallic < 0.1 && // Wood is non-metallic
                roughness > 0.6 && // Wood is rougher
                (baseColor[0] > baseColor[2] || baseColor[1] > baseColor[2]) // Wood tends to be warmer (more red/yellow than blue)
            );
            
            // Fabric detection: Low metallic, high roughness, varied colors
            const isFabric = (
                metallic < 0.1 && // Fabric is non-metallic
                roughness > 0.7 && // Fabric is very rough
                brightness > 0.3 && // Not too dark (unlike leather)
                !isWoodish // Not wood
            );
            
            // Metal detection: High metallic
            const isMetal = metallic > 0.8;
            
            // Leather detection: Low metallic, medium roughness, darker colors
            const isLeather = (
                metallic < 0.1 &&
                roughness > 0.5 && roughness < 0.8 &&
                brightness < 0.4 // Leather tends to be darker
            );
            
            if (isMetal) return 'metal';
            if (isWoodish) return 'wood';
            if (isFabric) return 'fabric';
            if (isLeather) return 'leather';
            
            return 'unknown';
        }
        
        function shouldColorMaterial(materialType) {
            // Only color fabric-like materials, leave wood/metal/leather unchanged
            return materialType === 'fabric';
        }

        // Image Management Functions - Moved to dedicated page
        
        function showImageUploadModal() {
            document.getElementById('imageUploadModal').style.display = 'flex';
        }
        
        function closeImageUploadModal() {
            document.getElementById('imageUploadModal').style.display = 'none';
            document.getElementById('imageUploadForm').reset();
            document.getElementById('imageFileName').style.display = 'none';
            const uploadArea = document.getElementById('imageFileUploadArea');
            uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.3)';
            uploadArea.style.background = 'rgba(13, 17, 23, 0.5)';
        }
        
        async function updateImageFileName() {
            const fileInput = document.getElementById('imageFile');
            const fileName = document.getElementById('imageFileName');
            const uploadArea = document.getElementById('imageFileUploadArea');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName.style.display = 'block';
                
                // Validate file type
                if (!file.name.match(/\.(jpg|jpeg|png|webp|svg)$/i)) {
                    fileName.textContent = '❌ Invalid file type';
                    fileName.style.background = 'rgba(248, 81, 73, 0.1)';
                    fileName.style.borderColor = 'rgba(248, 81, 73, 0.3)';
                    fileName.style.color = '#f85149';
                    return;
                } else if (file.size > 10 * 1024 * 1024) {
                    fileName.textContent = '❌ File too large (max 10MB)';
                    fileName.style.background = 'rgba(248, 81, 73, 0.1)';
                    fileName.style.borderColor = 'rgba(248, 81, 73, 0.3)';
                    fileName.style.color = '#f85149';
                    return;
                } else {
                    fileName.textContent = `⏳ Uploading ${file.name}...`;
                    fileName.style.background = 'rgba(88, 166, 255, 0.1)';
                    fileName.style.borderColor = 'rgba(88, 166, 255, 0.3)';
                    fileName.style.color = '#58a6ff';
                }
                
                uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.6)';
                uploadArea.style.background = 'rgba(88, 166, 255, 0.05)';
                
                // Auto-upload the file
                await uploadImageFile();
            } else {
                fileName.style.display = 'none';
                uploadArea.style.borderColor = 'rgba(88, 166, 255, 0.3)';
                uploadArea.style.background = 'rgba(13, 17, 23, 0.5)';
            }
        }
        
        async function uploadImageFile() {
            const fileInput = document.getElementById('imageFile');
            const imageType = document.getElementById('imageType').value;
            const fileName = document.getElementById('imageFileName');
            
            if (!fileInput.files.length) return;
            
            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('imageType', imageType);
                
                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    fileName.textContent = `✅ Uploaded successfully!`;
                    setTimeout(() => {
                        closeImageUploadModal();
                        loadImages();
                    }, 1500);
                } else {
                    fileName.textContent = `❌ Upload failed: ${result.error || 'Unknown error'}`;
                    fileName.style.color = '#f85149';
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                fileName.textContent = `❌ Upload error: ${error.message}`;
                fileName.style.color = '#f85149';
            }
        }
        
        // Old image functions removed - now handled by dedicated Images page
        
        // Prevent form submission since we're auto-uploading
        document.getElementById('imageUploadForm').addEventListener('submit', (e) => {
            e.preventDefault();
        });
        
        // Switch to variant function (handles both upload and color variants)
        function switchToVariant(modelId, variantId, variantUrl, hexColor = null, variantType = 'upload') {
            console.log('Switching to variant:', { modelId, variantId, variantUrl, hexColor, variantType });
            
            // Find the model-viewer element for this model
            const modelCards = document.querySelectorAll('.model-card');
            modelCards.forEach(card => {
                const modelViewer = card.querySelector('model-viewer');
                const hiddenModelId = card.querySelector('.model-id');
                
                if (hiddenModelId && hiddenModelId.textContent === modelId) {
                    // All variants are GLB file variants now - no color changing
                    console.log('Loading GLB variant:', variantUrl);
                    modelViewer.src = variantUrl;
                }
            });
        }
        
        // Update original variant colors after models load
        function updateOriginalVariantColors() {
            const modelCards = document.querySelectorAll('.model-card');
            modelCards.forEach(card => {
                const modelViewer = card.querySelector('model-viewer');
                const originalVariant = card.querySelector('.original-variant');
                
                if (modelViewer && originalVariant) {
                    const updateColor = async () => {
                        // Add a small delay to ensure the model is fully rendered
                        setTimeout(async () => {
                            const dominantColor = await extractDominantColor(modelViewer);
                            console.log('Extracted dominant color for model:', dominantColor);
                            originalVariant.style.background = dominantColor;
                        }, 1000); // Wait 1 second after model loads
                    };
                    
                    if (modelViewer.loaded) {
                        updateColor();
                    } else {
                        modelViewer.addEventListener('load', updateColor, { once: true });
                    }
                }
            });
        }
        
        // Extract and save model color after upload
        async function extractAndSaveModelColor(modelId) {
            try {
                console.log('Extracting color for uploaded model:', modelId);
                
                // Find the model card that was just uploaded
                const modelCards = document.querySelectorAll('.model-card');
                let targetModelViewer = null;
                
                for (const card of modelCards) {
                    const hiddenModelId = card.querySelector('.model-id');
                    if (hiddenModelId && hiddenModelId.textContent === modelId) {
                        targetModelViewer = card.querySelector('model-viewer');
                        break;
                    }
                }
                
                if (!targetModelViewer) {
                    console.warn('Model viewer not found for uploaded model');
                    return;
                }
                
                // Wait for model to load and extract color
                const waitForLoad = () => new Promise(resolve => {
                    if (targetModelViewer.loaded) {
                        resolve();
                    } else {
                        targetModelViewer.addEventListener('load', resolve, { once: true });
                    }
                });
                
                await waitForLoad();
                
                // Small delay to ensure model is rendered
                setTimeout(async () => {
                    const dominantColor = await extractDominantColor(targetModelViewer);
                    console.log('Extracted dominant color for new model:', dominantColor);
                    
                    // Save to database
                    try {
                        const response = await fetch('/api/update-color', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                modelId,
                                dominantColor
                            })
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('✅ Saved dominant color to database:', result);
                            
                            // Update the UI immediately
                            const originalVariant = targetModelViewer.closest('.model-card')?.querySelector('.original-variant');
                            if (originalVariant) {
                                originalVariant.style.background = dominantColor;
                            }
                        } else {
                            console.error('Failed to save dominant color');
                        }
                    } catch (error) {
                        console.error('Error saving dominant color:', error);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Error extracting model color:', error);
            }
        }
        
        // Delete a variant
        async function deleteVariant(variantId, modelId, event) {
            // Stop event propagation to prevent triggering the variant click
            event.stopPropagation();
            
            if (!confirm('Are you sure you want to delete this variant?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/models', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: variantId,
                        type: 'variant'
                    })
                });
                
                if (response.ok) {
                    console.log('✅ Variant deleted successfully');
                    // Refresh the models to reflect the change
                    loadModels();
                } else {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to delete variant');
                }
                
            } catch (error) {
                console.error('Error deleting variant:', error);
                alert('Failed to delete variant: ' + error.message);
            }
        }
        
        // Update colors when page loads (for existing models)
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(updateOriginalVariantColors, 3000); // Give models time to load and render
        });

        // ========================================
        // MODERN PAGE NAVIGATION SYSTEM
        // ========================================
        
        let currentPage = 'dashboard';
        let allImages = [];
        let filteredImages = [];
        
        // Universal Page Navigation
        function navigateToPage(pageName) {
            console.log(`🧭 Navigation requested to: ${pageName}`);
            
            // Hide all pages
            const allPages = document.querySelectorAll('.page');
            console.log(`📄 Found ${allPages.length} pages to hide`);
            allPages.forEach(page => {
                console.log(`🙈 Hiding page:`, page.id);
                page.style.display = 'none';
            });
            
            // Show selected page
            const targetPageId = pageName + 'Page';
            const targetPage = document.getElementById(targetPageId);
            console.log(`🎯 Looking for page with ID: ${targetPageId}`, targetPage);
            
            if (targetPage) {
                targetPage.style.display = 'block';
                currentPage = pageName;
                console.log(`✅ Successfully showed page: ${targetPageId}`);
            } else {
                console.error(`❌ Target page not found: ${targetPageId}`);
            }
            
            // Update navigation active state
            const allNavLinks = document.querySelectorAll('.sidebar-nav-link');
            console.log(`🔗 Found ${allNavLinks.length} nav links`);
            allNavLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[data-page="${pageName}"]`);
            console.log(`🎯 Looking for nav link with data-page="${pageName}"`, activeLink);
            if (activeLink) {
                activeLink.classList.add('active');
                console.log(`✅ Successfully activated nav link for: ${pageName}`);
            }
            
            // Initialize page-specific functionality
            console.log(`🚀 Initializing page-specific functionality for: ${pageName}`);
            switch(pageName) {
                case 'images':
                    console.log(`📸 Loading images page...`);
                    loadImagesPage();
                    break;
                case 'users':
                    console.log(`👥 Loading users page...`);
                    loadUsersPage();
                    break;
                case 'dashboard':
                    console.log(`🏠 Dashboard page (no initialization needed)`);
                    break;
                default:
                    console.warn(`⚠️ Unknown page: ${pageName}`);
            }
            
            console.log(`📄 Navigation completed to: ${pageName}`);
        }
        
        // ========================================
        // IMAGES PAGE FUNCTIONALITY
        // ========================================
        
        async function loadImagesPage() {
            try {
                console.log('🖼️ Loading images page...');
                const response = await fetch('/api/images');
                console.log('📡 Response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('📊 API Response:', result);
                    
                    const images = result.images || [];
                    console.log('🖼️ Images found:', images.length);
                    
                    allImages = images;
                    filteredImages = [...allImages];
                    
                    console.log('🔄 Populating customer filter...');
                    populateCustomerFilter();
                    
                    console.log('🎨 Displaying images grid...');
                    displayImagesGrid();
                } else {
                    console.error('❌ Failed to load images:', response.status, response.statusText);
                    document.getElementById('imagesGrid').innerHTML = `
                        <div class="empty-state">
                            <h3>Failed to Load Images</h3>
                            <p>Status: ${response.status} - ${response.statusText}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('💥 Error loading images page:', error);
                document.getElementById('imagesGrid').innerHTML = `
                    <div class="empty-state">
                        <h3>Error Loading Images</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function populateCustomerFilter() {
            const customerFilter = document.getElementById('imageCustomerFilter');
            if (!customerFilter) return;
            
            // Get unique customers from images
            const customers = [...new Set(allImages
                .filter(img => img.customer_id)
                .map(img => ({ id: img.customer_id, name: img.customer_name || img.customer_id }))
            )];
            
            // Clear existing options (keep "All Customers")
            customerFilter.innerHTML = '<option value="all">All Customers</option>';
            
            // Add customer options
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                customerFilter.appendChild(option);
            });
        }
        
        function filterImages() {
            const typeFilter = document.getElementById('imageTypeFilter').value;
            const customerFilter = document.getElementById('imageCustomerFilter').value;
            const searchFilter = document.getElementById('imageSearchFilter').value.toLowerCase();
            
            filteredImages = allImages.filter(image => {
                // Type filter
                if (typeFilter !== 'all' && image.image_type !== typeFilter) return false;
                
                // Customer filter
                if (customerFilter !== 'all' && image.customer_id !== customerFilter) return false;
                
                // Search filter
                if (searchFilter && !image.filename.toLowerCase().includes(searchFilter)) return false;
                
                return true;
            });
            
            displayImagesGrid();
        }
        
        function displayImagesGrid() {
            const grid = document.getElementById('imagesGrid');
            console.log('🎨 Display grid called, grid element:', grid);
            console.log('🎨 Filtered images count:', filteredImages.length);
            
            if (filteredImages.length === 0) {
                console.log('📭 No images to display');
                grid.innerHTML = `
                    <div class="empty-state">
                        <h3>No Images Found</h3>
                        <p>Try adjusting your filters or upload some images</p>
                    </div>
                `;
                return;
            }
            
            console.log('🎨 Rendering', filteredImages.length, 'images');
            
            grid.innerHTML = filteredImages.map(image => `
                <div class="image-card">
                    <div class="image-preview">
                        <img src="${image.cloudinary_url}" alt="${image.filename}" loading="lazy">
                    </div>
                    <div class="image-info">
                        <div class="image-title">${image.filename}</div>
                        <div class="image-meta">
                            ${Math.round(image.file_size / 1024)} KB • 
                            ${image.width}x${image.height}
                        </div>
                        <div class="image-actions">
                            <span class="image-type-badge">${image.image_type}</span>
                            <button class="image-delete-btn" onclick="deleteImageFromGrid('${image.id}', '${image.cloudinary_public_id}')">
                                🗑️
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async function deleteImageFromGrid(id, cloudinaryPublicId) {
            if (!confirm('Delete this image?')) return;
            
            try {
                const response = await fetch('/api/images', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, cloudinaryPublicId })
                });
                
                if (response.ok) {
                    // Remove from local arrays
                    allImages = allImages.filter(img => img.id !== id);
                    filteredImages = filteredImages.filter(img => img.id !== id);
                    
                    // Refresh display
                    displayImagesGrid();
                    populateCustomerFilter();
                } else {
                    alert('Failed to delete image');
                }
            } catch (error) {
                console.error('Error deleting image:', error);
                alert('Error deleting image');
            }
        }
        
        // ========================================
        // USERS PAGE FUNCTIONALITY
        // ========================================
        
        async function loadUsersPage() {
            try {
                console.log('👥 Loading users page...');
                const usersContainer = document.getElementById('usersContainer');
                console.log('📦 Users container:', usersContainer);
                
                if (!usersContainer) {
                    console.error('❌ Users container not found!');
                    return;
                }
                
                console.log('🎨 Setting users page content...');
                // For now, show a placeholder since we need to implement user listing
                usersContainer.innerHTML = `
                    <div class="user-card">
                        <div class="user-avatar">👤</div>
                        <div class="user-info">
                            <div class="user-name">Admin User</div>
                            <div class="user-role">Administrator</div>
                        </div>
                        <div class="user-actions">
                            <button class="user-action-btn">Edit</button>
                            <button class="user-action-btn danger">Deactivate</button>
                        </div>
                    </div>
                    <div class="empty-state" style="padding: 40px; text-align: center; color: #7d8590;">
                        <h3>User Management Coming Soon</h3>
                        <p>Full user management interface will be implemented next</p>
                    </div>
                `;
                console.log('✅ Users page content set successfully');
            } catch (error) {
                console.error('Error loading users page:', error);
            }
        }
        
        // ========================================
        // INITIALIZE PAGE SYSTEM
        // ========================================
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Modern page system initialized');
            // Dashboard is shown by default
        });
        
        // ========================================
        // CUSTOMER LOGO MANAGEMENT
        // ========================================
        
        let currentCustomerLogoData = null;
        
        async function showCustomerLogoUpload() {
            // Get current customer info
            const customerId = document.getElementById('editCustomerId').value.trim();
            const customerName = document.getElementById('editCustomerName').value.trim();
            
            if (!customerId || !customerName) {
                alert('Please save customer information first');
                return;
            }
            
            // Update the image upload modal to be customer-specific
            document.getElementById('imageType').value = 'customer_logo';
            
            // Store customer info for the upload
            window.currentCustomerForLogo = { id: customerId, name: customerName };
            
            // Show the image upload modal
            showImageUploadModal();
        }
        
        async function loadCustomerLogo(customerId) {
            if (!customerId) return;
            
            try {
                const response = await fetch(`/api/images?imageType=customer_logo&customerId=${customerId}`);
                if (response.ok) {
                    const { images } = await response.json();
                    const customerLogo = images && images.length > 0 ? images[0] : null;
                    
                    const logoContainer = document.getElementById('currentCustomerLogo');
                    const removeBtn = document.getElementById('removeLogoBtn');
                    
                    if (customerLogo) {
                        logoContainer.innerHTML = `<img src="${customerLogo.cloudinary_url}" alt="Customer Logo">`;
                        removeBtn.style.display = 'block';
                        currentCustomerLogoData = customerLogo;
                    } else {
                        logoContainer.innerHTML = '<div class="logo-placeholder">No logo uploaded</div>';
                        removeBtn.style.display = 'none';
                        currentCustomerLogoData = null;
                    }
                }
            } catch (error) {
                console.error('Error loading customer logo:', error);
            }
        }
        
        async function removeCustomerLogo() {
            if (!currentCustomerLogoData || !confirm('Remove this customer logo?')) return;
            
            try {
                const response = await fetch('/api/images', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: currentCustomerLogoData.id,
                        cloudinaryPublicId: currentCustomerLogoData.cloudinary_public_id
                    })
                });
                
                if (response.ok) {
                    // Reset logo display
                    document.getElementById('currentCustomerLogo').innerHTML = 
                        '<div class="logo-placeholder">No logo uploaded</div>';
                    document.getElementById('removeLogoBtn').style.display = 'none';
                    currentCustomerLogoData = null;
                } else {
                    alert('Failed to remove logo');
                }
            } catch (error) {
                console.error('Error removing logo:', error);
                alert('Error removing logo');
            }
        }
        
        // Enhanced openUserEditModal to load customer logo
        const originalOpenUserEditModal = openUserEditModal;
        openUserEditModal = function(userId, username, role, customerId, customerName, isActive, isAdmin) {
            originalOpenUserEditModal(userId, username, role, customerId, customerName, isActive, isAdmin);
            
            // Load customer logo if it's a customer
            if (role === 'customer' && customerId) {
                setTimeout(() => loadCustomerLogo(customerId), 500);
            }
        };
        
        // Enhanced image upload to handle customer logos
        const originalUploadImageFile = uploadImageFile;
        uploadImageFile = async function() {
            const fileInput = document.getElementById('imageFile');
            const imageType = document.getElementById('imageType').value;
            const fileName = document.getElementById('imageFileName');
            
            if (!fileInput.files.length) return;
            
            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('imageType', imageType);
                
                // If uploading customer logo, add customer info
                if (imageType === 'customer_logo' && window.currentCustomerForLogo) {
                    formData.append('customerId', window.currentCustomerForLogo.id);
                    formData.append('customerName', window.currentCustomerForLogo.name);
                }
                
                const response = await fetch('/api/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    fileName.textContent = `✅ Uploaded successfully!`;
                    
                    // If it's a customer logo, refresh the logo display
                    if (imageType === 'customer_logo' && window.currentCustomerForLogo) {
                        setTimeout(() => {
                            loadCustomerLogo(window.currentCustomerForLogo.id);
                        }, 1000);
                    }
                    
                    setTimeout(() => {
                        closeImageUploadModal();
                        if (currentPage === 'images') {
                            loadImagesPage();
                        }
                    }, 1500);
                } else {
                    fileName.textContent = `❌ Upload failed: ${result.error || 'Unknown error'}`;
                    fileName.style.color = '#f85149';
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                fileName.textContent = `❌ Upload error: ${error.message}`;
                fileName.style.color = '#f85149';
            } finally {
                // Clean up customer logo context
                window.currentCustomerForLogo = null;
            }
        };
    </script>
        </div>
    </div>
</body>
</html>
